import{d as Q,o as C,c as Z,r as j,n as at,b as tt,l as it,P as F,e as G,ar as rt,D as nt,w as ot,M as dt}from"./framework.CV-qDdUt.js";const lt="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let st=(i=21)=>{let t="",e=crypto.getRandomValues(new Uint8Array(i));for(;i--;)t+=lt[e[i]&63];return t};var T=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ct(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var ht="Expected a function",z=NaN,ut="[object Symbol]",vt=/^\s+|\s+$/g,ft=/^[-+]0x[0-9a-f]+$/i,mt=/^0b[01]+$/i,yt=/^0o[0-7]+$/i,gt=parseInt,pt=typeof T=="object"&&T&&T.Object===Object&&T,bt=typeof self=="object"&&self&&self.Object===Object&&self,wt=pt||bt||Function("return this")(),xt=Object.prototype,St=xt.toString,kt=Math.max,_t=Math.min,B=function(){return wt.Date.now()};function Pt(i,t,e){var n,a,r,o,l,s,d=0,c=!1,h=!1,u=!0;if(typeof i!="function")throw new TypeError(ht);t=X(t)||0,I(e)&&(c=!!e.leading,h="maxWait"in e,r=h?kt(X(e.maxWait)||0,t):r,u="trailing"in e?!!e.trailing:u);function f(m){var S=n,_=a;return n=a=void 0,d=m,o=i.apply(_,S),o}function p(m){return d=m,l=setTimeout(w,t),c?f(m):o}function b(m){var S=m-s,_=m-d,O=t-S;return h?_t(O,r-_):O}function y(m){var S=m-s,_=m-d;return s===void 0||S>=t||S<0||h&&_>=r}function w(){var m=B();if(y(m))return x(m);l=setTimeout(w,b(m))}function x(m){return l=void 0,u&&n?f(m):(n=a=void 0,o)}function $(){l!==void 0&&clearTimeout(l),d=0,n=s=a=l=void 0}function L(){return l===void 0?o:x(B())}function P(){var m=B(),S=y(m);if(n=arguments,a=this,s=m,S){if(l===void 0)return p(s);if(h)return l=setTimeout(w,t),f(s)}return l===void 0&&(l=setTimeout(w,t)),o}return P.cancel=$,P.flush=L,P}function I(i){var t=typeof i;return!!i&&(t=="object"||t=="function")}function Ot(i){return!!i&&typeof i=="object"}function $t(i){return typeof i=="symbol"||Ot(i)&&St.call(i)==ut}function X(i){if(typeof i=="number")return i;if($t(i))return z;if(I(i)){var t=typeof i.valueOf=="function"?i.valueOf():i;i=I(t)?t+"":t}if(typeof i!="string")return i===0?i:+i;i=i.replace(vt,"");var e=mt.test(i);return e||yt.test(i)?gt(i.slice(2),e?2:8):ft.test(i)?z:+i}var Lt=Pt;const Y=ct(Lt);var Tt=function(t){return typeof t=="function"},k=function(t){return t===void 0},Ct=function(t){return typeof t=="string"},At=function(t,e,n){return Array.from({length:t},function(){return new Array(e).fill(n)})},g=function(t,e){return k(t)?e:t};function N(i,t,e,n){function a(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function l(c){try{d(n.next(c))}catch(h){o(h)}}function s(c){try{d(n.throw(c))}catch(h){o(h)}}function d(c){c.done?r(c.value):a(c.value).then(l,s)}d((n=n.apply(i,[])).next())})}function A(i,t){var e={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},n,a,r,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(d){return function(c){return s([d,c])}}function s(d){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,d[0]&&(e=0)),e;)try{if(n=1,a&&(r=d[0]&2?a.return:d[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,d[1])).done)return r;switch(a=0,r&&(d=[d[0]&2,r.value]),d[0]){case 0:case 1:r=d;break;case 4:return e.label++,{value:d[1],done:!1};case 5:e.label++,a=d[1],d=[0];continue;case 7:d=e.ops.pop(),e.trys.pop();continue;default:if(r=e.trys,!(r=r.length>0&&r[r.length-1])&&(d[0]===6||d[0]===2)){e=0;continue}if(d[0]===3&&(!r||d[1]>r[0]&&d[1]<r[3])){e.label=d[1];break}if(d[0]===6&&e.label<r[1]){e.label=r[1],r=d;break}if(r&&e.label<r[2]){e.label=r[2],e.ops.push(d);break}r[2]&&e.ops.pop(),e.trys.pop();continue}d=t.call(i,e)}catch(c){d=[6,c],a=0}finally{n=r=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}var q=function(i,t,e){t===void 0&&(t=void 0),e===void 0&&(e=void 0);var n=new Image;return n.setAttribute("crossOrigin","Anonymous"),!k(t)&&(n.width=t),!k(e)&&(n.height=e),n.src=i,new Promise(function(a){n.onload=function(){a(n)}})},Ht=function(i){var t=i.outerHTML.replace(/<img(.*?)>/g,"<img$1/>").replace(/\n/g,"").replace(/\t/g,"").replace(/#/g,"%23");return"data:image/svg+xml;charset=utf-8,".concat(t)},U=function(i,t,e){t===void 0&&(t={}),e===void 0&&(e="http://www.w3.org/2000/svg");var n=document.createElementNS(e,i);for(var a in t)n.setAttribute(a,t[a]);return n},Wt=function(i,t){return N(void 0,void 0,void 0,function(){var e,n,a,r,o,l,s,d;return A(this,function(c){switch(c.label){case 0:return e=U("svg",{xmlns:"http://www.w3.org/2000/svg"}),n=document.createElement("div"),n.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),n.style.cssText=`
  text-align: center;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  font: `.concat(i.font,`;
  color: `).concat(t.fontColor,`;
`),n.innerHTML='<div class="rich-text-content">'.concat(t.content,"</div>"),document.body.appendChild(n),[4,Et(n)];case 1:return c.sent(),a=n.querySelector(".rich-text-content"),r=a.offsetHeight,o=a.offsetWidth,document.body.removeChild(n),l=t.richTextWidth||o||t.width,s=t.richTextHeight||r||t.height,e.setAttribute("width",l.toString()),e.setAttribute("height",s.toString()),d=U("foreignObject",{width:l.toString(),height:s.toString()}),d.appendChild(n),e.appendChild(d),[2,{element:e,width:l,height:s}]}})})},Et=function(i){return N(void 0,void 0,void 0,function(){var t,e,n,a,r;return A(this,function(o){switch(o.label){case 0:t=i.querySelectorAll("img"),e=function(l){var s,d,c,h,u;return A(this,function(f){switch(f.label){case 0:if(s=l.getAttribute("src"),!s)return[3,6];f.label=1;case 1:return f.trys.push([1,5,,6]),[4,fetch(s)];case 2:return d=f.sent(),[4,d.blob()];case 3:return c=f.sent(),[4,new Promise(function(p,b){var y=new FileReader;y.onloadend=function(){return p(y.result)},y.onerror=b,y.readAsDataURL(c)})];case 4:return h=f.sent(),Ct(h)&&l.setAttribute("src",h),[3,6];case 5:return u=f.sent(),console.error("Error converting ".concat(s," to base64:"),u),[3,6];case 6:return[2]}})},n=0,a=Array.from(t),o.label=1;case 1:return n<a.length?(r=a[n],[5,e(r)]):[3,4];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},Bt=function(i){return i.toDataURL("image/png",1)},It=function(i,t,e){for(var n=[],a="",r=0,o=t.length;r<o;r++)a+=t.charAt(r),i.measureText(a).width>e&&(n.push(a.substring(0,a.length-1)),a="",r--);return n.push(a),n},v={width:300,height:300,rotate:45,layout:"default",auxiliaryLine:!1,translatePlacement:"middle",contentType:"text",content:"hello watermark-js-plus",textType:"fill",imageWidth:0,imageHeight:0,lineHeight:30,zIndex:2147483647,backgroundPosition:"0 0",backgroundRepeat:"repeat",fontSize:"20px",fontFamily:"sans-serif",fontStyle:"",fontVariant:"",fontColor:"#000",fontWeight:"normal",filter:"none",letterSpacing:"0px",globalAlpha:.5,mode:"default",mutationObserve:!0,movable:!1,parent:"body",onSuccess:function(){},onBeforeDestroy:function(){},onDestroyed:function(){},onObserveError:function(){}},Mt=function(i,t,e){var n=i.getContext("2d");if(n===null)throw new Error("get context error");n.font="".concat(t.fontStyle," ").concat(t.fontVariant," ").concat(t.fontWeight," ").concat(t.fontSize," ").concat(t.fontFamily),n.filter=t.filter,n.letterSpacing=t.letterSpacing,t!=null&&t.rotate&&(t.rotate=(360-t.rotate%360)*(Math.PI/180)),k(e.textRowMaxWidth)&&(t.textRowMaxWidth=t.width);var a={image:{rect:{width:t.imageWidth,height:t.imageHeight},position:{x:0,y:0}},textLine:{data:[],yOffsetValue:0},advancedStyleParams:{linear:{x0:0,x1:0},radial:{x0:0,y0:0,r0:0,x1:0,y1:0,r1:0},conic:{x:0,y:0,startAngle:0},pattern:{}}};switch(t.contentType){case"text":a.textLine.data=[t.content];break;case"multi-line-text":a.textLine.data=It(n,t.content,t.textRowMaxWidth);break}var r=t.width/2,o=t.height/2,l="middle",s="center";switch(!k(e==null?void 0:e.translateX)&&!k(e==null?void 0:e.translateY)?(r=e==null?void 0:e.translateX,o=e==null?void 0:e.translateY,l="top",s="left"):(a.advancedStyleParams.linear.x0=-t.width/2,a.advancedStyleParams.linear.x1=t.width/2,a.advancedStyleParams.radial.r0=0,a.advancedStyleParams.radial.r1=t.width/2),e.translatePlacement){case"top":r=t.width/2,o=0,l="top",a.advancedStyleParams.linear.x0=-t.width/2,a.advancedStyleParams.linear.x1=t.width/2,a.advancedStyleParams.radial.y0=a.textLine.data.length*t.lineHeight/2,a.advancedStyleParams.radial.y1=a.textLine.data.length*t.lineHeight/2,a.advancedStyleParams.conic.y=a.textLine.data.length*t.lineHeight/2;break;case"top-start":r=0,o=0,l="top",s="start",a.advancedStyleParams.linear.x0=0,a.advancedStyleParams.linear.x1=t.width,a.advancedStyleParams.radial.x0=t.width/2,a.advancedStyleParams.radial.y0=a.textLine.data.length*t.lineHeight/2,a.advancedStyleParams.radial.x1=t.width/2,a.advancedStyleParams.radial.y1=a.textLine.data.length*t.lineHeight/2,a.advancedStyleParams.conic.x=t.width/2,a.advancedStyleParams.conic.y=a.textLine.data.length*t.lineHeight/2;break;case"top-end":r=t.width,o=0,l="top",s="end",a.advancedStyleParams.linear.x0=0,a.advancedStyleParams.linear.x1=-t.width,a.advancedStyleParams.radial.x0=-t.width/2,a.advancedStyleParams.radial.y0=a.textLine.data.length*t.lineHeight/2,a.advancedStyleParams.radial.x1=-t.width/2,a.advancedStyleParams.radial.y1=a.textLine.data.length*t.lineHeight/2,a.advancedStyleParams.conic.x=-t.width/2,a.advancedStyleParams.conic.y=a.textLine.data.length*t.lineHeight/2;break;case"bottom":r=t.width/2,o=t.height,l="bottom",a.advancedStyleParams.linear.x0=-t.width/2,a.advancedStyleParams.linear.x1=t.width/2,a.advancedStyleParams.radial.y0=-a.textLine.data.length*t.lineHeight/2,a.advancedStyleParams.radial.y1=-a.textLine.data.length*t.lineHeight/2,a.advancedStyleParams.conic.x=0,a.advancedStyleParams.conic.y=-a.textLine.data.length*t.lineHeight/2;break;case"bottom-start":r=0,o=t.height,l="bottom",s="start",a.advancedStyleParams.linear.x0=0,a.advancedStyleParams.linear.x1=t.width,a.advancedStyleParams.radial.x0=t.width/2,a.advancedStyleParams.radial.y0=-a.textLine.data.length*t.lineHeight/2,a.advancedStyleParams.radial.x1=t.width/2,a.advancedStyleParams.radial.y1=-a.textLine.data.length*t.lineHeight/2,a.advancedStyleParams.conic.x=t.width/2,a.advancedStyleParams.conic.y=-a.textLine.data.length*t.lineHeight/2;break;case"bottom-end":r=t.width,o=t.height,l="bottom",s="end",a.advancedStyleParams.linear.x0=0,a.advancedStyleParams.linear.x1=-t.width,a.advancedStyleParams.radial.x0=-t.width/2,a.advancedStyleParams.radial.y0=-a.textLine.data.length*t.lineHeight/2,a.advancedStyleParams.radial.x1=-t.width/2,a.advancedStyleParams.radial.y1=-a.textLine.data.length*t.lineHeight/2,a.advancedStyleParams.conic.x=-t.width/2,a.advancedStyleParams.conic.y=-a.textLine.data.length*t.lineHeight/2;break;case"left":r=0,o=t.height/2,s="start",a.advancedStyleParams.linear.x0=0,a.advancedStyleParams.linear.x1=t.width,a.advancedStyleParams.radial.x0=t.width/2,a.advancedStyleParams.radial.x1=t.width/2,a.advancedStyleParams.conic.x=t.width/2,a.advancedStyleParams.conic.y=0;break;case"right":r=t.width,o=t.height/2,s="end",a.advancedStyleParams.linear.x0=0,a.advancedStyleParams.linear.x1=-t.width,a.advancedStyleParams.radial.x0=-t.width/2,a.advancedStyleParams.radial.x1=-t.width/2,a.advancedStyleParams.conic.x=-t.width/2,a.advancedStyleParams.conic.y=0;break}if(t.translateX=r,t.translateY=o,k(e==null?void 0:e.textBaseline)&&(t.textBaseline=l),k(e==null?void 0:e.textAlign)&&(t.textAlign=s),["text","multi-line-text"].indexOf(t.contentType)>-1)switch(t.textBaseline){case"middle":a.textLine.yOffsetValue=(a.textLine.data.length-1)*t.lineHeight/2;break;case"bottom":case"alphabetic":case"ideographic":a.textLine.yOffsetValue=(a.textLine.data.length-1)*t.lineHeight+(t.lineHeight-parseInt(t.fontSize))/2;break;case"top":case"hanging":a.textLine.yOffsetValue=-t.lineHeight/2+parseInt(t.fontSize)/2;break}return a},et=function(){function i(t,e){this.props=t,this.options=e,this.canvas=i.createCanvas(this.options.width,this.options.height),this.recommendOptions=Mt(this.canvas,this.options,this.props)}return i.createCanvas=function(t,e){var n,a=window.devicePixelRatio||1,r=document.createElement("canvas");return r.width=t*a,r.height=e*a,r.style.width="".concat(t,"px"),r.style.height="".concat(e,"px"),(n=r.getContext("2d"))===null||n===void 0||n.setTransform(a,0,0,a,0,0),r},i.clearCanvas=function(t){var e=t.getContext("2d");if(e===null)throw new Error("get context error");e.restore(),e.clearRect(0,0,t.width,t.height)},i.prototype.getCanvas=function(){return this.canvas},i.prototype.clear=function(){i.clearCanvas(this.canvas)},i.prototype.draw=function(){var t=this,e=this.canvas.getContext("2d");if(e===null)throw new Error("get context error");return this.options.auxiliaryLine&&(e.beginPath(),e.rect(0,0,this.options.width,this.options.height),e.lineWidth=1,e.strokeStyle="#000",e.stroke(),e.closePath(),e.beginPath(),e.rect(this.options.translateX,this.options.translateY,1,1),e.lineWidth=1,e.strokeStyle="#f00",e.stroke(),e.closePath()),this.setStyle(e),e.save(),e.translate(this.options.translateX,this.options.translateY),e.rotate(this.options.rotate),new Promise(function(n){switch(t.options.contentType){case"text":t.drawText(e,n);break;case"image":t.drawImage(e,n);break;case"multi-line-text":t.drawMultiLineText(e,n);break;case"rich-text":t.drawRichText(e,n);break}})},i.prototype.setStyle=function(t){var e,n="fillStyle";this.options.textType==="stroke"&&(n="strokeStyle");var a=this.options.fontColor;if(!((e=this.options)===null||e===void 0)&&e.advancedStyle)switch(this.options.advancedStyle.type){case"linear":a=this.createLinearGradient(t);break;case"radial":a=this.createRadialGradient(t);break;case"conic":a=this.createConicGradient(t);break;case"pattern":a=this.createPattern(t);break}t[n]&&a&&(t[n]=a),this.options.textAlign&&(t.textAlign=this.options.textAlign),this.options.textBaseline&&(t.textBaseline=this.options.textBaseline),t.globalAlpha=this.options.globalAlpha,this.options.shadowStyle&&(t.shadowBlur=g(this.options.shadowStyle.shadowBlur,0),t.shadowColor=g(this.options.shadowStyle.shadowColor,"#00000000"),t.shadowOffsetX=g(this.options.shadowStyle.shadowOffsetX,0),t.shadowOffsetY=g(this.options.shadowStyle.shadowOffsetY,0)),Tt(this.options.extraDrawFunc)&&this.options.extraDrawFunc(t)},i.prototype.createLinearGradient=function(t){var e,n,a,r,o,l,s,d,c,h,u,f,p,b,y,w=t.createLinearGradient(g((a=(n=(e=this.options.advancedStyle)===null||e===void 0?void 0:e.params)===null||n===void 0?void 0:n.linear)===null||a===void 0?void 0:a.x0,this.recommendOptions.advancedStyleParams.linear.x0),g((l=(o=(r=this.options.advancedStyle)===null||r===void 0?void 0:r.params)===null||o===void 0?void 0:o.linear)===null||l===void 0?void 0:l.y0,0),g((c=(d=(s=this.options.advancedStyle)===null||s===void 0?void 0:s.params)===null||d===void 0?void 0:d.linear)===null||c===void 0?void 0:c.x1,this.recommendOptions.advancedStyleParams.linear.x1),g((f=(u=(h=this.options.advancedStyle)===null||h===void 0?void 0:h.params)===null||u===void 0?void 0:u.linear)===null||f===void 0?void 0:f.y1,0));return(y=(b=(p=this.options)===null||p===void 0?void 0:p.advancedStyle)===null||b===void 0?void 0:b.colorStops)===null||y===void 0||y.forEach(function(x){w.addColorStop(x.offset,x.color)}),w},i.prototype.createConicGradient=function(t){var e,n,a,r,o,l,s,d,c,h,u,f,p,b,y,w=t.createConicGradient(g((r=(a=(n=(e=this.options)===null||e===void 0?void 0:e.advancedStyle)===null||n===void 0?void 0:n.params)===null||a===void 0?void 0:a.conic)===null||r===void 0?void 0:r.startAngle,0),g((d=(s=(l=(o=this.options)===null||o===void 0?void 0:o.advancedStyle)===null||l===void 0?void 0:l.params)===null||s===void 0?void 0:s.conic)===null||d===void 0?void 0:d.x,this.recommendOptions.advancedStyleParams.conic.x),g((f=(u=(h=(c=this.options)===null||c===void 0?void 0:c.advancedStyle)===null||h===void 0?void 0:h.params)===null||u===void 0?void 0:u.conic)===null||f===void 0?void 0:f.y,this.recommendOptions.advancedStyleParams.conic.y));return(y=(b=(p=this.options)===null||p===void 0?void 0:p.advancedStyle)===null||b===void 0?void 0:b.colorStops)===null||y===void 0||y.forEach(function(x){w.addColorStop(x.offset,x.color)}),w},i.prototype.createRadialGradient=function(t){var e,n,a,r,o,l,s,d,c,h,u,f,p,b,y,w,x,$,L,P,m,S,_,O,H,W,E,V=t.createRadialGradient(g((r=(a=(n=(e=this.options)===null||e===void 0?void 0:e.advancedStyle)===null||n===void 0?void 0:n.params)===null||a===void 0?void 0:a.radial)===null||r===void 0?void 0:r.x0,this.recommendOptions.advancedStyleParams.radial.x0),g((d=(s=(l=(o=this.options)===null||o===void 0?void 0:o.advancedStyle)===null||l===void 0?void 0:l.params)===null||s===void 0?void 0:s.radial)===null||d===void 0?void 0:d.y0,this.recommendOptions.advancedStyleParams.radial.y0),g((f=(u=(h=(c=this.options)===null||c===void 0?void 0:c.advancedStyle)===null||h===void 0?void 0:h.params)===null||u===void 0?void 0:u.radial)===null||f===void 0?void 0:f.r0,this.recommendOptions.advancedStyleParams.radial.r0),g((w=(y=(b=(p=this.options)===null||p===void 0?void 0:p.advancedStyle)===null||b===void 0?void 0:b.params)===null||y===void 0?void 0:y.radial)===null||w===void 0?void 0:w.x1,this.recommendOptions.advancedStyleParams.radial.x1),g((P=(L=($=(x=this.options)===null||x===void 0?void 0:x.advancedStyle)===null||$===void 0?void 0:$.params)===null||L===void 0?void 0:L.radial)===null||P===void 0?void 0:P.y1,this.recommendOptions.advancedStyleParams.radial.y1),g((O=(_=(S=(m=this.options)===null||m===void 0?void 0:m.advancedStyle)===null||S===void 0?void 0:S.params)===null||_===void 0?void 0:_.radial)===null||O===void 0?void 0:O.r1,this.recommendOptions.advancedStyleParams.radial.r1));return(E=(W=(H=this.options)===null||H===void 0?void 0:H.advancedStyle)===null||W===void 0?void 0:W.colorStops)===null||E===void 0||E.forEach(function(D){V.addColorStop(D.offset,D.color)}),V},i.prototype.createPattern=function(t){var e,n,a,r,o,l,s,d;return t.createPattern((r=(a=(n=(e=this.options)===null||e===void 0?void 0:e.advancedStyle)===null||n===void 0?void 0:n.params)===null||a===void 0?void 0:a.pattern)===null||r===void 0?void 0:r.image,((d=(s=(l=(o=this.options)===null||o===void 0?void 0:o.advancedStyle)===null||l===void 0?void 0:l.params)===null||s===void 0?void 0:s.pattern)===null||d===void 0?void 0:d.repetition)||"")},i.prototype.setText=function(t,e){var n="fillText";this.options.textType==="stroke"&&(n="strokeText"),t[n]&&t[n](e.text,e.x,e.y,e.maxWidth)},i.prototype.drawText=function(t,e){this.setText(t,{text:this.options.content,x:0,y:0-this.recommendOptions.textLine.yOffsetValue,maxWidth:this.options.textRowMaxWidth||this.options.width}),e(t.canvas)},i.prototype.drawImage=function(t,e){var n=this;q(this.options.image).then(function(a){var r=n.getImageRect(a),o=r.width,l=r.height,s=n.getDrawImagePosition(o,l);t.drawImage(a,s.x,s.y,o,l),e(t.canvas)})},i.prototype.drawMultiLineText=function(t,e){var n=this,a=this.recommendOptions.textLine.data,r=this.recommendOptions.textLine.yOffsetValue;a.forEach(function(o,l){n.setText(t,{text:o,x:0,y:n.options.lineHeight*l-r})}),e(t.canvas)},i.prototype.drawRichText=function(t,e){return N(this,void 0,void 0,function(){var n,a=this;return A(this,function(r){switch(r.label){case 0:return[4,Wt(t,this.options)];case 1:return n=r.sent(),q(Ht(n.element),n.width,n.height).then(function(o){var l=a.getDrawImagePosition(o.width,o.height);t.drawImage(o,l.x,l.y,o.width,o.height),e(t.canvas)}),[2]}})})},i.prototype.getImageRect=function(t){var e={width:this.options.imageWidth||0,height:this.options.imageHeight||0};switch(!0){case(e.width!==0&&e.height===0):e.height=e.width*t.height/t.width;break;case(e.width===0&&e.height!==0):e.width=e.height*t.width/t.height;break;case(e.width===0&&e.height===0):e.width=t.width,e.height=t.height;break}return e},i.prototype.getDrawImagePosition=function(t,e){var n,a,r={x:-t/2,y:-e/2};switch(this.options.translatePlacement){case"top":r.x=-t/2,r.y=0;break;case"top-start":r.x=0,r.y=0;break;case"top-end":r.x=-t,r.y=0;break;case"bottom":r.x=-t/2,r.y=-e;break;case"bottom-start":r.x=0,r.y=-e;break;case"bottom-end":r.x=-t,r.y=-e;break;case"left":r.x=0,r.y=-e/2;break;case"right":r.x=-t,r.y=-e/2;break}return!k((n=this.props)===null||n===void 0?void 0:n.translateX)&&(r.x=0),!k((a=this.props)===null||a===void 0?void 0:a.translateY)&&(r.y=0),r},i}(),jt=function(){function i(t,e){var n,a,r,o;this.options=t,this.partialWidth=this.options.width,this.partialHeight=this.options.height,this.rows=((n=this.options.gridLayoutOptions)===null||n===void 0?void 0:n.rows)||1,this.cols=((a=this.options.gridLayoutOptions)===null||a===void 0?void 0:a.cols)||1,this.matrix=((r=this.options.gridLayoutOptions)===null||r===void 0?void 0:r.matrix)||At(this.rows,this.cols,1),this.gap=((o=this.options.gridLayoutOptions)===null||o===void 0?void 0:o.gap)||[0,0],this.partialCanvas=e}return i.prototype.draw=function(){var t,e,n,a,r,o,l,s,d=et.createCanvas(((t=this.options.gridLayoutOptions)===null||t===void 0?void 0:t.width)||this.partialWidth*this.cols+this.gap[0]*this.cols,((e=this.options.gridLayoutOptions)===null||e===void 0?void 0:e.height)||this.partialHeight*this.rows+this.gap[1]*this.rows),c=d.getContext("2d");!((n=this.options.gridLayoutOptions)===null||n===void 0)&&n.backgroundImage&&(c==null||c.drawImage((a=this.options.gridLayoutOptions)===null||a===void 0?void 0:a.backgroundImage,0,0,(r=this.options.gridLayoutOptions)===null||r===void 0?void 0:r.width,(o=this.options.gridLayoutOptions)===null||o===void 0?void 0:o.height));for(var h=0;h<this.rows;h++)for(var u=0;u<this.cols;u++)!((s=(l=this.matrix)===null||l===void 0?void 0:l[h])===null||s===void 0)&&s[u]&&(c==null||c.drawImage(this.partialCanvas,this.partialWidth*u+this.gap[0]*u,this.partialHeight*h+this.gap[1]*h,this.partialWidth,this.partialHeight));return d},i}(),Nt=function(i,t){switch(i.layout){case"grid":return new jt(i,t).draw();default:return t}},Rt=function(i){var t,e,n;switch(i.layout){case"grid":{var a=((t=i.gridLayoutOptions)===null||t===void 0?void 0:t.cols)||1,r=((e=i.gridLayoutOptions)===null||e===void 0?void 0:e.rows)||1,o=((n=i.gridLayoutOptions)===null||n===void 0?void 0:n.gap)||[0,0];return[i.width*a+o[0]*a,i.height*r+o[1]*r]}default:return[i.width,i.height]}};const Vt={name:"Teleport",props:{to:{type:String,required:!0},where:{type:String,default:"after"},disabled:Boolean},data(){return{nodes:[],waiting:!1,observer:null,parent:null}},computed:{classes(){return this.disabled?["teleport"]:["teleport","teleport-hidden"]}},watch:{to:"maybeMove",where:"maybeMove",disabled(i){i?(this.disable(),this.teardownObserver()):(this.bootObserver(),this.move())}},mounted(){this.nodes=Array.from(this.$el.childNodes),this.disabled||this.bootObserver(),this.maybeMove()},beforeUnmount(){this.disable(),this.teardownObserver()},methods:{maybeMove(){this.disabled?console.log(this.$el):this.move()},move(){if(this.waiting=!1,this.parent=document.querySelector(this.to),!this.parent){this.disable(),this.waiting=!0;return}this.where==="before"?this.parent.prepend(this.getFragment()):this.parent.appendChild(this.getFragment())},disable(){this.$el.appendChild(this.getFragment()),this.parent=null},getFragment(){const i=document.createDocumentFragment();return this.nodes.forEach(t=>i.appendChild(t)),i},onMutations(i){let t=!1;for(let e=0;e<i.length;e++){const n=i[e],a=Array.from(n.addedNodes).filter(r=>!this.nodes.includes(r));Array.from(n.removedNodes).includes(this.parent)?(this.disable(),this.waiting=!this.disabled):this.waiting&&a.length>0&&(t=!0)}t&&this.move()},bootObserver(){this.observer||(this.observer=new MutationObserver(i=>this.onMutations(i)),this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!1,characterData:!1}))},teardownObserver(){this.observer&&(this.observer.disconnect(),this.observer=null)}}},R=(i,t)=>{const e=i.__vccOpts||i;for(const[n,a]of t)e[n]=a;return e};function Dt(i,t,e,n,a,r){return C(),Z("div",{class:at(r.classes)},[j(i.$slots,"default")],2)}const K=R(Vt,[["render",Dt]]),Ft=Q({name:"Watermark",directives:{},props:{modelValue:{type:Boolean,default:!0},width:{type:Number,default:v.width},height:{type:Number,default:v.height},rotate:{type:Number,default:v.rotate},layout:{type:String,default:v.layout},gridLayoutOptions:{type:Object,default:void 0},auxiliaryLine:{type:Boolean,default:v.auxiliaryLine},globalAlpha:{type:Number,default:v.globalAlpha},zIndex:{type:Number,default:10},mutationObserve:{type:Boolean,default:!1},movable:{type:Boolean,default:v.movable},mode:{type:String,default:v.mode},backgroundPosition:{type:String,default:v.backgroundPosition},backgroundRepeat:{type:String,default:v.backgroundRepeat},translatePlacement:{type:String,default:void 0},translateX:{type:Number,default:void 0},translateY:{type:Number,default:void 0},contentType:{type:String,default:v.contentType},content:{type:String,default:v.content},textType:{type:String,default:v.textType},lineHeight:{type:Number,default:v.lineHeight},fontSize:{type:String,default:v.fontSize},fontFamily:{type:String,default:v.fontFamily},fontStyle:{type:String,default:v.fontStyle},fontVariant:{type:String,default:v.fontVariant},fontColor:{type:String,default:v.fontColor},fontWeight:{type:String,default:v.fontWeight},textAlign:{type:String,default:void 0},textBaseline:{type:String,default:void 0},filter:{type:String,default:v.filter},textRowMaxWidth:{type:Number,default:void 0},richTextWidth:{type:Number,default:void 0},richTextHeight:{type:Number,default:void 0},image:{type:String,default:void 0},imageWidth:{type:Number,default:v.imageWidth},imageHeight:{type:Number,default:v.imageHeight},shadowStyle:{type:Object,default:void 0},advancedStyle:{type:Object,default:void 0},appendToBody:{type:Boolean,default:!1}},emits:["success","error","beforeDestroy","destroyed","observeSuccess","observeError","update:modelValue"],data(){return{key:"",watermarkCanvas:null,watermarkImage:"",observer:null,parentObserve:null,observing:!1}},computed:{options(){return{...v,...this.$props}},watermarkWrapperStyle(){const i=this.mutationObserve?"!important":"";return{...this.mutationObserve&&{"z-index":`${this.zIndex}${i}`,display:`block${i}`,visibility:`visible${i}`,transform:`none${i}`,scale:`none${i}`},position:`relative${i}`}},watermarkStyle(){const i=this.mutationObserve?"!important":"",t=Rt({layout:this.layout,width:this.width,height:this.height,gridLayoutOptions:this.gridLayoutOptions});return{...this.mutationObserve&&{visibility:`visible${i}`,transform:`none${i}`,scale:`none${i}`},"z-index":`${this.zIndex}${i}`,display:`block${i}`,width:`100%${i}`,height:`100%${i}`,"pointer-events":`none${i}`,left:`0${i}`,right:`0${i}`,top:`0${i}`,bottom:`0${i}`,position:`${this.appendToBody?"fixed":"absolute"}${i}`,"background-image":`url(${this.watermarkImage})${i}`,"background-repeat":`${this.backgroundRepeat}${i}`,"background-size":`${t[0]}px ${t[1]}px${i}`,"background-position":`${this.backgroundPosition}${i}`,...this.movable&&{animation:`200s ease 0s infinite normal none running watermark ${i}`}}}},watch:{options:{deep:!0,handler:async function(){await this.create()}},modelValue(i){i?this.handleObserver():this.removeObserver()}},created(){},async mounted(){await this.create(),this.$emit("success")},methods:{generateKey(){return this.mutationObserve?st(6):"watermark"},create:Y(async function(){this.watermarkCanvas=new et(this.$props,this.options),this.remove(),this.key=this.generateKey();try{this.$nextTick(()=>{this.draw()})}catch{this.$emit("error")}},10),update:Y(async function(){this.remove(),this.key=this.generateKey();try{this.$nextTick(()=>{this.draw()})}catch{this.$emit("error")}},10),async draw(){var i,t,e;this.mutationObserve&&(this.$refs.watermarkWrapperRef.id=`watermark-${this.key}`),await((i=this.watermarkCanvas)==null?void 0:i.draw());const n=Nt(this.options,(t=this.watermarkCanvas)==null?void 0:t.getCanvas());this.watermarkImage=Bt(n),(e=this.watermarkCanvas)==null||e.clear(),this.$nextTick(()=>{this.handleObserver()})},remove(){var i;this.$emit("beforeDestroy"),this.removeObserver(),this.mutationObserve&&((i=document.querySelector(`#watermark-${this.key}`))==null||i.remove()),this.$emit("destroyed")},handleObserver(){if(!this.mutationObserve){this.observing=!1;return}try{!this.observing&&this.addObserver(),this.observing=!0,this.$emit("observeSuccess")}catch{this.$emit("observeError"),this.observing=!1}},addObserver(){const i=this.$refs.watermarkWrapperRef,t=i.parentElement;this.observer=new MutationObserver(async e=>{e.length>0&&await this.update()}),this.observer.observe(i,{attributes:!0,childList:!0,subtree:!1,characterData:!0}),this.parentObserve=new MutationObserver(async e=>{var n;for(const a of e)((a==null?void 0:a.target)===i||((n=a==null?void 0:a.removedNodes)==null?void 0:n[0])===i||a.type==="childList"&&a.target===t&&a.target.lastChild!==i)&&await this.update()}),this.parentObserve.observe(t,{attributes:!0,childList:!0,subtree:!0,characterData:!0})},removeObserver(){var i,t;(i=this.observer)==null||i.disconnect(),(t=this.parentObserve)==null||t.disconnect(),this.observing=!1}}});function Gt(i,t,e,n,a,r){return i.key?(C(),tt(rt,{to:"body",disabled:!i.appendToBody,key:i.key},[it("div",{style:F(i.watermarkWrapperStyle),ref:"watermarkWrapperRef"},[j(i.$slots,"default"),i.modelValue?(C(),Z("div",{key:0,style:F(i.watermarkStyle)},null,4)):G("",!0)],4)],8,["disabled"])):G("",!0)}const M=R(Ft,[["render",Gt]]),zt=Q({name:"BlindWatermark",components:{watermark:M},directives:{},props:{globalAlpha:{type:Number,default:.005},mode:{type:String,default:"blind"},modelValue:{type:Boolean,default:!0}},data(){return{}},computed:{},watch:{},created(){},mounted(){},methods:{}});function Xt(i,t,e,n,a,r){const o=nt("Watermark");return C(),tt(o,dt(i.$attrs,{globalAlpha:i.globalAlpha,mode:i.mode}),{default:ot(()=>[j(i.$slots,"default")]),_:3},16,["globalAlpha","mode"])}const J=R(zt,[["render",Xt]]),qt={install(i){i.component(M.name,M),i.component(J.name,J),i.component(K.name,K)}};export{qt as default,K as teleport,M as watermark};
