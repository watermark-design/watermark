import{d as K,o as T,c as Q,r as j,n as tt,b as J,m as et,Q as V,e as D,aq as at,E as it,w as nt,N as rt}from"./framework.C9BN7Nfo.js";const ot="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let dt=(a=21)=>{let t="",i=crypto.getRandomValues(new Uint8Array(a));for(;a--;)t+=ot[i[a]&63];return t};var C=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function lt(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var st="Expected a function",F=NaN,ht="[object Symbol]",ct=/^\s+|\s+$/g,vt=/^[-+]0x[0-9a-f]+$/i,ut=/^0b[01]+$/i,mt=/^0o[0-7]+$/i,yt=parseInt,ft=typeof C=="object"&&C&&C.Object===Object&&C,pt=typeof self=="object"&&self&&self.Object===Object&&self,gt=ft||pt||Function("return this")(),bt=Object.prototype,wt=bt.toString,xt=Math.max,St=Math.min,B=function(){return gt.Date.now()};function _t(a,t,i){var n,e,r,o,d,l,s=0,u=!1,c=!1,m=!0;if(typeof a!="function")throw new TypeError(st);t=z(t)||0,E(i)&&(u=!!i.leading,c="maxWait"in i,r=c?xt(z(i.maxWait)||0,t):r,m="trailing"in i?!!i.trailing:m);function f(v){var S=n,k=e;return n=e=void 0,s=v,o=a.apply(k,S),o}function b(v){return s=v,d=setTimeout(g,t),u?f(v):o}function w(v){var S=v-l,k=v-s,O=t-S;return c?St(O,r-k):O}function p(v){var S=v-l,k=v-s;return l===void 0||S>=t||S<0||c&&k>=r}function g(){var v=B();if(p(v))return x(v);d=setTimeout(g,w(v))}function x(v){return d=void 0,m&&n?f(v):(n=e=void 0,o)}function $(){d!==void 0&&clearTimeout(d),s=0,n=l=e=d=void 0}function L(){return d===void 0?o:x(B())}function P(){var v=B(),S=p(v);if(n=arguments,e=this,l=v,S){if(d===void 0)return b(l);if(c)return d=setTimeout(g,t),f(l)}return d===void 0&&(d=setTimeout(g,t)),o}return P.cancel=$,P.flush=L,P}function E(a){var t=typeof a;return!!a&&(t=="object"||t=="function")}function kt(a){return!!a&&typeof a=="object"}function Pt(a){return typeof a=="symbol"||kt(a)&&wt.call(a)==ht}function z(a){if(typeof a=="number")return a;if(Pt(a))return F;if(E(a)){var t=typeof a.valueOf=="function"?a.valueOf():a;a=E(t)?t+"":t}if(typeof a!="string")return a===0?a:+a;a=a.replace(ct,"");var i=ut.test(a);return i||mt.test(a)?yt(a.slice(2),i?2:8):vt.test(a)?F:+a}var Ot=_t;const G=lt(Ot);var $t=function(t){return typeof t=="function"},_=function(t){return t===void 0},Lt=function(t,i,n){return Array.from({length:t},function(){return new Array(i).fill(n)})},y=function(t,i){return _(t)?i:t},X=function(a,t,i){t===void 0&&(t=void 0),i===void 0&&(i=void 0);var n=new Image;return n.setAttribute("crossOrigin","Anonymous"),!_(t)&&(n.width=t),!_(i)&&(n.height=i),n.src=a,new Promise(function(e){n.onload=function(){e(n)}})},Ct=function(a){var t=a.outerHTML.replace(/\n/g,"").replace(/\t/g,"").replace(/#/g,"%23");return"data:image/svg+xml;charset=utf-8,".concat(t)},Y=function(a,t,i){t===void 0&&(t={}),i===void 0&&(i="http://www.w3.org/2000/svg");var n=document.createElementNS(i,a);for(var e in t)n.setAttribute(e,t[e]);return n},Tt=function(a,t){var i=Y("svg",{xmlns:"http://www.w3.org/2000/svg"}),n=document.createElement("div");n.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),n.style.cssText=`
  text-align: center;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  font: `.concat(a.font,`;
  color: `).concat(t.fontColor,`;
`),n.innerHTML='<div class="rich-text-content">'.concat(t.content,"</div>"),document.body.appendChild(n);var e=n.querySelector(".rich-text-content"),r=e.offsetHeight,o=e.offsetWidth;document.body.removeChild(n);var d=t.richTextWidth||o||t.width,l=t.richTextHeight||r||t.height;i.setAttribute("width",d.toString()),i.setAttribute("height",l.toString());var s=Y("foreignObject",{width:d.toString(),height:l.toString()});return s.appendChild(n),i.appendChild(s),{element:i,width:d,height:l}},Ht=function(a){return a.toDataURL("image/png",1)},Wt=function(a,t,i){for(var n=[],e="",r=0,o=t.length;r<o;r++)e+=t.charAt(r),a.measureText(e).width>i&&(n.push(e.substring(0,e.length-1)),e="",r--);return n.push(e),n},h={width:300,height:300,rotate:45,layout:"default",auxiliaryLine:!1,translatePlacement:"middle",contentType:"text",content:"hello watermark-js-plus",textType:"fill",imageWidth:0,imageHeight:0,lineHeight:30,zIndex:2147483647,backgroundPosition:"0 0",backgroundRepeat:"repeat",fontSize:"20px",fontFamily:"sans-serif",fontStyle:"",fontVariant:"",fontColor:"#000",fontWeight:"normal",filter:"none",letterSpacing:"0px",globalAlpha:.5,mode:"default",mutationObserve:!0,movable:!1,parent:"body",onSuccess:function(){},onBeforeDestroy:function(){},onDestroyed:function(){},onObserveError:function(){}},At=function(a,t,i){var n=a.getContext("2d");if(n===null)throw new Error("get context error");n.font="".concat(t.fontStyle," ").concat(t.fontVariant," ").concat(t.fontWeight," ").concat(t.fontSize," ").concat(t.fontFamily),n.filter=t.filter,n.letterSpacing=t.letterSpacing,t!=null&&t.rotate&&(t.rotate=(360-t.rotate%360)*(Math.PI/180)),_(i.textRowMaxWidth)&&(t.textRowMaxWidth=t.width);var e={image:{rect:{width:t.imageWidth,height:t.imageHeight},position:{x:0,y:0}},textLine:{data:[],yOffsetValue:0},advancedStyleParams:{linear:{x0:0,x1:0},radial:{x0:0,y0:0,r0:0,x1:0,y1:0,r1:0},conic:{x:0,y:0,startAngle:0},pattern:{}}};switch(t.contentType){case"text":e.textLine.data=[t.content];break;case"multi-line-text":e.textLine.data=Wt(n,t.content,t.textRowMaxWidth);break}var r=t.width/2,o=t.height/2,d="middle",l="center";switch(!_(i==null?void 0:i.translateX)&&!_(i==null?void 0:i.translateY)?(r=i==null?void 0:i.translateX,o=i==null?void 0:i.translateY,d="top",l="left"):(e.advancedStyleParams.linear.x0=-t.width/2,e.advancedStyleParams.linear.x1=t.width/2,e.advancedStyleParams.radial.r0=0,e.advancedStyleParams.radial.r1=t.width/2),i.translatePlacement){case"top":r=t.width/2,o=0,d="top",e.advancedStyleParams.linear.x0=-t.width/2,e.advancedStyleParams.linear.x1=t.width/2,e.advancedStyleParams.radial.y0=e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.radial.y1=e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.conic.y=e.textLine.data.length*t.lineHeight/2;break;case"top-start":r=0,o=0,d="top",l="start",e.advancedStyleParams.linear.x0=0,e.advancedStyleParams.linear.x1=t.width,e.advancedStyleParams.radial.x0=t.width/2,e.advancedStyleParams.radial.y0=e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.radial.x1=t.width/2,e.advancedStyleParams.radial.y1=e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.conic.x=t.width/2,e.advancedStyleParams.conic.y=e.textLine.data.length*t.lineHeight/2;break;case"top-end":r=t.width,o=0,d="top",l="end",e.advancedStyleParams.linear.x0=0,e.advancedStyleParams.linear.x1=-t.width,e.advancedStyleParams.radial.x0=-t.width/2,e.advancedStyleParams.radial.y0=e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.radial.x1=-t.width/2,e.advancedStyleParams.radial.y1=e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.conic.x=-t.width/2,e.advancedStyleParams.conic.y=e.textLine.data.length*t.lineHeight/2;break;case"bottom":r=t.width/2,o=t.height,d="bottom",e.advancedStyleParams.linear.x0=-t.width/2,e.advancedStyleParams.linear.x1=t.width/2,e.advancedStyleParams.radial.y0=-e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.radial.y1=-e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.conic.x=0,e.advancedStyleParams.conic.y=-e.textLine.data.length*t.lineHeight/2;break;case"bottom-start":r=0,o=t.height,d="bottom",l="start",e.advancedStyleParams.linear.x0=0,e.advancedStyleParams.linear.x1=t.width,e.advancedStyleParams.radial.x0=t.width/2,e.advancedStyleParams.radial.y0=-e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.radial.x1=t.width/2,e.advancedStyleParams.radial.y1=-e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.conic.x=t.width/2,e.advancedStyleParams.conic.y=-e.textLine.data.length*t.lineHeight/2;break;case"bottom-end":r=t.width,o=t.height,d="bottom",l="end",e.advancedStyleParams.linear.x0=0,e.advancedStyleParams.linear.x1=-t.width,e.advancedStyleParams.radial.x0=-t.width/2,e.advancedStyleParams.radial.y0=-e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.radial.x1=-t.width/2,e.advancedStyleParams.radial.y1=-e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.conic.x=-t.width/2,e.advancedStyleParams.conic.y=-e.textLine.data.length*t.lineHeight/2;break;case"left":r=0,o=t.height/2,l="start",e.advancedStyleParams.linear.x0=0,e.advancedStyleParams.linear.x1=t.width,e.advancedStyleParams.radial.x0=t.width/2,e.advancedStyleParams.radial.x1=t.width/2,e.advancedStyleParams.conic.x=t.width/2,e.advancedStyleParams.conic.y=0;break;case"right":r=t.width,o=t.height/2,l="end",e.advancedStyleParams.linear.x0=0,e.advancedStyleParams.linear.x1=-t.width,e.advancedStyleParams.radial.x0=-t.width/2,e.advancedStyleParams.radial.x1=-t.width/2,e.advancedStyleParams.conic.x=-t.width/2,e.advancedStyleParams.conic.y=0;break}if(t.translateX=r,t.translateY=o,_(i==null?void 0:i.textBaseline)&&(t.textBaseline=d),_(i==null?void 0:i.textAlign)&&(t.textAlign=l),["text","multi-line-text"].indexOf(t.contentType)>-1)switch(t.textBaseline){case"middle":e.textLine.yOffsetValue=(e.textLine.data.length-1)*t.lineHeight/2;break;case"bottom":case"alphabetic":case"ideographic":e.textLine.yOffsetValue=(e.textLine.data.length-1)*t.lineHeight+(t.lineHeight-parseInt(t.fontSize))/2;break;case"top":case"hanging":e.textLine.yOffsetValue=-t.lineHeight/2+parseInt(t.fontSize)/2;break}return e},Z=function(){function a(t,i){this.props=t,this.options=i,this.canvas=a.createCanvas(this.options.width,this.options.height),this.recommendOptions=At(this.canvas,this.options,this.props)}return a.createCanvas=function(t,i){var n,e=window.devicePixelRatio||1,r=document.createElement("canvas");return r.width=t*e,r.height=i*e,r.style.width="".concat(t,"px"),r.style.height="".concat(i,"px"),(n=r.getContext("2d"))===null||n===void 0||n.setTransform(e,0,0,e,0,0),r},a.clearCanvas=function(t){var i=t.getContext("2d");if(i===null)throw new Error("get context error");i.restore(),i.clearRect(0,0,t.width,t.height)},a.prototype.getCanvas=function(){return this.canvas},a.prototype.clear=function(){a.clearCanvas(this.canvas)},a.prototype.draw=function(){var t=this,i=this.canvas.getContext("2d");if(i===null)throw new Error("get context error");return this.options.auxiliaryLine&&(i.beginPath(),i.rect(0,0,this.options.width,this.options.height),i.lineWidth=1,i.strokeStyle="#000",i.stroke(),i.closePath(),i.beginPath(),i.rect(this.options.translateX,this.options.translateY,1,1),i.lineWidth=1,i.strokeStyle="#f00",i.stroke(),i.closePath()),this.setStyle(i),i.save(),i.translate(this.options.translateX,this.options.translateY),i.rotate(this.options.rotate),new Promise(function(n){switch(t.options.contentType){case"text":t.drawText(i,n);break;case"image":t.drawImage(i,n);break;case"multi-line-text":t.drawMultiLineText(i,n);break;case"rich-text":t.drawRichText(i,n);break}})},a.prototype.setStyle=function(t){var i,n="fillStyle";this.options.textType==="stroke"&&(n="strokeStyle");var e=this.options.fontColor;if(!((i=this.options)===null||i===void 0)&&i.advancedStyle)switch(this.options.advancedStyle.type){case"linear":e=this.createLinearGradient(t);break;case"radial":e=this.createRadialGradient(t);break;case"conic":e=this.createConicGradient(t);break;case"pattern":e=this.createPattern(t);break}t[n]&&e&&(t[n]=e),this.options.textAlign&&(t.textAlign=this.options.textAlign),this.options.textBaseline&&(t.textBaseline=this.options.textBaseline),t.globalAlpha=this.options.globalAlpha,this.options.shadowStyle&&(t.shadowBlur=y(this.options.shadowStyle.shadowBlur,0),t.shadowColor=y(this.options.shadowStyle.shadowColor,"#00000000"),t.shadowOffsetX=y(this.options.shadowStyle.shadowOffsetX,0),t.shadowOffsetY=y(this.options.shadowStyle.shadowOffsetY,0)),$t(this.options.extraDrawFunc)&&this.options.extraDrawFunc(t)},a.prototype.createLinearGradient=function(t){var i,n,e,r,o,d,l,s,u,c,m,f,b,w,p,g=t.createLinearGradient(y((e=(n=(i=this.options.advancedStyle)===null||i===void 0?void 0:i.params)===null||n===void 0?void 0:n.linear)===null||e===void 0?void 0:e.x0,this.recommendOptions.advancedStyleParams.linear.x0),y((d=(o=(r=this.options.advancedStyle)===null||r===void 0?void 0:r.params)===null||o===void 0?void 0:o.linear)===null||d===void 0?void 0:d.y0,0),y((u=(s=(l=this.options.advancedStyle)===null||l===void 0?void 0:l.params)===null||s===void 0?void 0:s.linear)===null||u===void 0?void 0:u.x1,this.recommendOptions.advancedStyleParams.linear.x1),y((f=(m=(c=this.options.advancedStyle)===null||c===void 0?void 0:c.params)===null||m===void 0?void 0:m.linear)===null||f===void 0?void 0:f.y1,0));return(p=(w=(b=this.options)===null||b===void 0?void 0:b.advancedStyle)===null||w===void 0?void 0:w.colorStops)===null||p===void 0||p.forEach(function(x){g.addColorStop(x.offset,x.color)}),g},a.prototype.createConicGradient=function(t){var i,n,e,r,o,d,l,s,u,c,m,f,b,w,p,g=t.createConicGradient(y((r=(e=(n=(i=this.options)===null||i===void 0?void 0:i.advancedStyle)===null||n===void 0?void 0:n.params)===null||e===void 0?void 0:e.conic)===null||r===void 0?void 0:r.startAngle,0),y((s=(l=(d=(o=this.options)===null||o===void 0?void 0:o.advancedStyle)===null||d===void 0?void 0:d.params)===null||l===void 0?void 0:l.conic)===null||s===void 0?void 0:s.x,this.recommendOptions.advancedStyleParams.conic.x),y((f=(m=(c=(u=this.options)===null||u===void 0?void 0:u.advancedStyle)===null||c===void 0?void 0:c.params)===null||m===void 0?void 0:m.conic)===null||f===void 0?void 0:f.y,this.recommendOptions.advancedStyleParams.conic.y));return(p=(w=(b=this.options)===null||b===void 0?void 0:b.advancedStyle)===null||w===void 0?void 0:w.colorStops)===null||p===void 0||p.forEach(function(x){g.addColorStop(x.offset,x.color)}),g},a.prototype.createRadialGradient=function(t){var i,n,e,r,o,d,l,s,u,c,m,f,b,w,p,g,x,$,L,P,v,S,k,O,H,W,A,M=t.createRadialGradient(y((r=(e=(n=(i=this.options)===null||i===void 0?void 0:i.advancedStyle)===null||n===void 0?void 0:n.params)===null||e===void 0?void 0:e.radial)===null||r===void 0?void 0:r.x0,this.recommendOptions.advancedStyleParams.radial.x0),y((s=(l=(d=(o=this.options)===null||o===void 0?void 0:o.advancedStyle)===null||d===void 0?void 0:d.params)===null||l===void 0?void 0:l.radial)===null||s===void 0?void 0:s.y0,this.recommendOptions.advancedStyleParams.radial.y0),y((f=(m=(c=(u=this.options)===null||u===void 0?void 0:u.advancedStyle)===null||c===void 0?void 0:c.params)===null||m===void 0?void 0:m.radial)===null||f===void 0?void 0:f.r0,this.recommendOptions.advancedStyleParams.radial.r0),y((g=(p=(w=(b=this.options)===null||b===void 0?void 0:b.advancedStyle)===null||w===void 0?void 0:w.params)===null||p===void 0?void 0:p.radial)===null||g===void 0?void 0:g.x1,this.recommendOptions.advancedStyleParams.radial.x1),y((P=(L=($=(x=this.options)===null||x===void 0?void 0:x.advancedStyle)===null||$===void 0?void 0:$.params)===null||L===void 0?void 0:L.radial)===null||P===void 0?void 0:P.y1,this.recommendOptions.advancedStyleParams.radial.y1),y((O=(k=(S=(v=this.options)===null||v===void 0?void 0:v.advancedStyle)===null||S===void 0?void 0:S.params)===null||k===void 0?void 0:k.radial)===null||O===void 0?void 0:O.r1,this.recommendOptions.advancedStyleParams.radial.r1));return(A=(W=(H=this.options)===null||H===void 0?void 0:H.advancedStyle)===null||W===void 0?void 0:W.colorStops)===null||A===void 0||A.forEach(function(R){M.addColorStop(R.offset,R.color)}),M},a.prototype.createPattern=function(t){var i,n,e,r,o,d,l,s;return t.createPattern((r=(e=(n=(i=this.options)===null||i===void 0?void 0:i.advancedStyle)===null||n===void 0?void 0:n.params)===null||e===void 0?void 0:e.pattern)===null||r===void 0?void 0:r.image,((s=(l=(d=(o=this.options)===null||o===void 0?void 0:o.advancedStyle)===null||d===void 0?void 0:d.params)===null||l===void 0?void 0:l.pattern)===null||s===void 0?void 0:s.repetition)||"")},a.prototype.setText=function(t,i){var n="fillText";this.options.textType==="stroke"&&(n="strokeText"),t[n]&&t[n](i.text,i.x,i.y,i.maxWidth)},a.prototype.drawText=function(t,i){this.setText(t,{text:this.options.content,x:0,y:0-this.recommendOptions.textLine.yOffsetValue,maxWidth:this.options.textRowMaxWidth||this.options.width}),i(t.canvas)},a.prototype.drawImage=function(t,i){var n=this;X(this.options.image).then(function(e){var r=n.getImageRect(e),o=r.width,d=r.height,l=n.getDrawImagePosition(o,d);t.drawImage(e,l.x,l.y,o,d),i(t.canvas)})},a.prototype.drawMultiLineText=function(t,i){var n=this,e=this.recommendOptions.textLine.data,r=this.recommendOptions.textLine.yOffsetValue;e.forEach(function(o,d){n.setText(t,{text:o,x:0,y:n.options.lineHeight*d-r})}),i(t.canvas)},a.prototype.drawRichText=function(t,i){var n=this,e=Tt(t,this.options);X(Ct(e.element),e.width,e.height).then(function(r){var o=n.getDrawImagePosition(r.width,r.height);t.drawImage(r,o.x,o.y,r.width,r.height),i(t.canvas)})},a.prototype.getImageRect=function(t){var i={width:this.options.imageWidth||0,height:this.options.imageHeight||0};switch(!0){case(i.width!==0&&i.height===0):i.height=i.width*t.height/t.width;break;case(i.width===0&&i.height!==0):i.width=i.height*t.width/t.height;break;case(i.width===0&&i.height===0):i.width=t.width,i.height=t.height;break}return i},a.prototype.getDrawImagePosition=function(t,i){var n,e,r={x:-t/2,y:-i/2};switch(this.options.translatePlacement){case"top":r.x=-t/2,r.y=0;break;case"top-start":r.x=0,r.y=0;break;case"top-end":r.x=-t,r.y=0;break;case"bottom":r.x=-t/2,r.y=-i;break;case"bottom-start":r.x=0,r.y=-i;break;case"bottom-end":r.x=-t,r.y=-i;break;case"left":r.x=0,r.y=-i/2;break;case"right":r.x=-t,r.y=-i/2;break}return!_((n=this.props)===null||n===void 0?void 0:n.translateX)&&(r.x=0),!_((e=this.props)===null||e===void 0?void 0:e.translateY)&&(r.y=0),r},a}(),Bt=function(){function a(t,i){var n,e,r,o;this.options=t,this.partialWidth=this.options.width,this.partialHeight=this.options.height,this.rows=((n=this.options.gridLayoutOptions)===null||n===void 0?void 0:n.rows)||1,this.cols=((e=this.options.gridLayoutOptions)===null||e===void 0?void 0:e.cols)||1,this.matrix=((r=this.options.gridLayoutOptions)===null||r===void 0?void 0:r.matrix)||Lt(this.rows,this.cols,1),this.gap=((o=this.options.gridLayoutOptions)===null||o===void 0?void 0:o.gap)||[0,0],this.partialCanvas=i}return a.prototype.draw=function(){var t,i,n,e,r,o,d,l,s=Z.createCanvas(((t=this.options.gridLayoutOptions)===null||t===void 0?void 0:t.width)||this.partialWidth*this.cols+this.gap[0]*this.cols,((i=this.options.gridLayoutOptions)===null||i===void 0?void 0:i.height)||this.partialHeight*this.rows+this.gap[1]*this.rows),u=s.getContext("2d");!((n=this.options.gridLayoutOptions)===null||n===void 0)&&n.backgroundImage&&(u==null||u.drawImage((e=this.options.gridLayoutOptions)===null||e===void 0?void 0:e.backgroundImage,0,0,(r=this.options.gridLayoutOptions)===null||r===void 0?void 0:r.width,(o=this.options.gridLayoutOptions)===null||o===void 0?void 0:o.height));for(var c=0;c<this.rows;c++)for(var m=0;m<this.cols;m++)!((l=(d=this.matrix)===null||d===void 0?void 0:d[c])===null||l===void 0)&&l[m]&&(u==null||u.drawImage(this.partialCanvas,this.partialWidth*m+this.gap[0]*m,this.partialHeight*c+this.gap[1]*c,this.partialWidth,this.partialHeight));return s},a}(),Et=function(a,t){switch(a.layout){case"grid":return new Bt(a,t).draw();default:return t}},Nt=function(a){var t,i,n;switch(a.layout){case"grid":{var e=((t=a.gridLayoutOptions)===null||t===void 0?void 0:t.cols)||1,r=((i=a.gridLayoutOptions)===null||i===void 0?void 0:i.rows)||1,o=((n=a.gridLayoutOptions)===null||n===void 0?void 0:n.gap)||[0,0];return[a.width*e+o[0]*e,a.height*r+o[1]*r]}default:return[a.width,a.height]}};const jt={name:"Teleport",props:{to:{type:String,required:!0},where:{type:String,default:"after"},disabled:Boolean},data(){return{nodes:[],waiting:!1,observer:null,parent:null}},computed:{classes(){return this.disabled?["teleport"]:["teleport","teleport-hidden"]}},watch:{to:"maybeMove",where:"maybeMove",disabled(a){a?(this.disable(),this.teardownObserver()):(this.bootObserver(),this.move())}},mounted(){this.nodes=Array.from(this.$el.childNodes),this.disabled||this.bootObserver(),this.maybeMove()},beforeUnmount(){this.disable(),this.teardownObserver()},methods:{maybeMove(){this.disabled?console.log(this.$el):this.move()},move(){if(this.waiting=!1,this.parent=document.querySelector(this.to),!this.parent){this.disable(),this.waiting=!0;return}this.where==="before"?this.parent.prepend(this.getFragment()):this.parent.appendChild(this.getFragment())},disable(){this.$el.appendChild(this.getFragment()),this.parent=null},getFragment(){const a=document.createDocumentFragment();return this.nodes.forEach(t=>a.appendChild(t)),a},onMutations(a){let t=!1;for(let i=0;i<a.length;i++){const n=a[i],e=Array.from(n.addedNodes).filter(r=>!this.nodes.includes(r));Array.from(n.removedNodes).includes(this.parent)?(this.disable(),this.waiting=!this.disabled):this.waiting&&e.length>0&&(t=!0)}t&&this.move()},bootObserver(){this.observer||(this.observer=new MutationObserver(a=>this.onMutations(a)),this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!1,characterData:!1}))},teardownObserver(){this.observer&&(this.observer.disconnect(),this.observer=null)}}},I=(a,t)=>{const i=a.__vccOpts||a;for(const[n,e]of t)i[n]=e;return i};function It(a,t,i,n,e,r){return T(),Q("div",{class:tt(r.classes)},[j(a.$slots,"default")],2)}const q=I(jt,[["render",It]]),Mt=K({name:"Watermark",directives:{},props:{modelValue:{type:Boolean,default:!0},width:{type:Number,default:h.width},height:{type:Number,default:h.height},rotate:{type:Number,default:h.rotate},layout:{type:String,default:h.layout},gridLayoutOptions:{type:Object,default:void 0},auxiliaryLine:{type:Boolean,default:h.auxiliaryLine},globalAlpha:{type:Number,default:h.globalAlpha},zIndex:{type:Number,default:10},mutationObserve:{type:Boolean,default:!1},movable:{type:Boolean,default:h.movable},mode:{type:String,default:h.mode},backgroundPosition:{type:String,default:h.backgroundPosition},backgroundRepeat:{type:String,default:h.backgroundRepeat},translatePlacement:{type:String,default:void 0},translateX:{type:Number,default:void 0},translateY:{type:Number,default:void 0},contentType:{type:String,default:h.contentType},content:{type:String,default:h.content},textType:{type:String,default:h.textType},lineHeight:{type:Number,default:h.lineHeight},fontSize:{type:String,default:h.fontSize},fontFamily:{type:String,default:h.fontFamily},fontStyle:{type:String,default:h.fontStyle},fontVariant:{type:String,default:h.fontVariant},fontColor:{type:String,default:h.fontColor},fontWeight:{type:String,default:h.fontWeight},textAlign:{type:String,default:void 0},textBaseline:{type:String,default:void 0},filter:{type:String,default:h.filter},textRowMaxWidth:{type:Number,default:void 0},richTextWidth:{type:Number,default:void 0},richTextHeight:{type:Number,default:void 0},image:{type:String,default:void 0},imageWidth:{type:Number,default:h.imageWidth},imageHeight:{type:Number,default:h.imageHeight},shadowStyle:{type:Object,default:void 0},advancedStyle:{type:Object,default:void 0},appendToBody:{type:Boolean,default:!1}},emits:["success","error","beforeDestroy","destroyed","observeSuccess","observeError","update:modelValue"],data(){return{key:"",watermarkCanvas:null,watermarkImage:"",observer:null,parentObserve:null,observing:!1}},computed:{options(){return{...h,...this.$props}},watermarkWrapperStyle(){const a=this.mutationObserve?"!important":"";return{...this.mutationObserve&&{"z-index":`${this.zIndex}${a}`,display:`block${a}`,visibility:`visible${a}`,transform:`none${a}`,scale:`none${a}`},position:`relative${a}`}},watermarkStyle(){const a=this.mutationObserve?"!important":"",t=Nt({layout:this.layout,width:this.width,height:this.height,gridLayoutOptions:this.gridLayoutOptions});return{...this.mutationObserve&&{visibility:`visible${a}`,transform:`none${a}`,scale:`none${a}`},"z-index":`${this.zIndex}${a}`,display:`block${a}`,width:`100%${a}`,height:`100%${a}`,"pointer-events":`none${a}`,left:`0${a}`,right:`0${a}`,top:`0${a}`,bottom:`0${a}`,position:`${this.appendToBody?"fixed":"absolute"}${a}`,"background-image":`url(${this.watermarkImage})${a}`,"background-repeat":`${this.backgroundRepeat}${a}`,"background-size":`${t[0]}px ${t[1]}px${a}`,"background-position":`${this.backgroundPosition}${a}`,...this.movable&&{animation:`200s ease 0s infinite normal none running watermark ${a}`}}}},watch:{options:{deep:!0,handler:async function(){await this.create()}},modelValue(a){a?this.handleObserver():this.removeObserver()}},created(){},async mounted(){await this.create(),this.$emit("success")},methods:{generateKey(){return this.mutationObserve?dt(6):"watermark"},create:G(async function(){this.watermarkCanvas=new Z(this.$props,this.options),this.remove(),this.key=this.generateKey();try{this.$nextTick(()=>{this.draw()})}catch{this.$emit("error")}},10),update:G(async function(){this.remove(),this.key=this.generateKey();try{this.$nextTick(()=>{this.draw()})}catch{this.$emit("error")}},10),async draw(){var a,t,i;this.mutationObserve&&(this.$refs.watermarkWrapperRef.id=`watermark-${this.key}`),await((a=this.watermarkCanvas)==null?void 0:a.draw());const n=Et(this.options,(t=this.watermarkCanvas)==null?void 0:t.getCanvas());this.watermarkImage=Ht(n),(i=this.watermarkCanvas)==null||i.clear(),this.$nextTick(()=>{this.handleObserver()})},remove(){var a;this.$emit("beforeDestroy"),this.removeObserver(),this.mutationObserve&&((a=document.querySelector(`#watermark-${this.key}`))==null||a.remove()),this.$emit("destroyed")},handleObserver(){if(!this.mutationObserve){this.observing=!1;return}try{!this.observing&&this.addObserver(),this.observing=!0,this.$emit("observeSuccess")}catch{this.$emit("observeError"),this.observing=!1}},addObserver(){const a=this.$refs.watermarkWrapperRef,t=a.parentElement;this.observer=new MutationObserver(async i=>{i.length>0&&await this.update()}),this.observer.observe(a,{attributes:!0,childList:!0,subtree:!1,characterData:!0}),this.parentObserve=new MutationObserver(async i=>{var n;for(const e of i)((e==null?void 0:e.target)===a||((n=e==null?void 0:e.removedNodes)==null?void 0:n[0])===a||e.type==="childList"&&e.target===t&&e.target.lastChild!==a)&&await this.update()}),this.parentObserve.observe(t,{attributes:!0,childList:!0,subtree:!0,characterData:!0})},removeObserver(){var a,t;(a=this.observer)==null||a.disconnect(),(t=this.parentObserve)==null||t.disconnect(),this.observing=!1}}});function Rt(a,t,i,n,e,r){return a.key?(T(),J(at,{to:"body",disabled:!a.appendToBody,key:a.key},[et("div",{style:V(a.watermarkWrapperStyle),ref:"watermarkWrapperRef"},[j(a.$slots,"default"),a.modelValue?(T(),Q("div",{key:0,style:V(a.watermarkStyle)},null,4)):D("",!0)],4)],8,["disabled"])):D("",!0)}const N=I(Mt,[["render",Rt]]),Vt=K({name:"BlindWatermark",components:{watermark:N},directives:{},props:{globalAlpha:{type:Number,default:.005},mode:{type:String,default:"blind"},modelValue:{type:Boolean,default:!0}},data(){return{}},computed:{},watch:{},created(){},mounted(){},methods:{}});function Dt(a,t,i,n,e,r){const o=it("Watermark");return T(),J(o,rt(a.$attrs,{globalAlpha:a.globalAlpha,mode:a.mode}),{default:nt(()=>[j(a.$slots,"default")]),_:3},16,["globalAlpha","mode"])}const U=I(Vt,[["render",Dt]]),zt={install(a){a.component(N.name,N),a.component(U.name,U),a.component(q.name,q)}};export{zt as default,q as teleport,N as watermark};
