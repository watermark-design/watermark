import{d as J,o as T,c as j,r as I,n as it,b as Q,k as Z,N as W,e as H,aw as tt}from"./framework.40f75acf.js";const rt={name:"Teleport",props:{to:{type:String,required:!0},where:{type:String,default:"after"},disabled:Boolean},data(){return{nodes:[],waiting:!1,observer:null,parent:null}},computed:{classes(){return this.disabled?["teleport"]:["teleport","teleport-hidden"]}},watch:{to:"maybeMove",where:"maybeMove",disabled(e){e?(this.disable(),this.teardownObserver()):(this.bootObserver(),this.move())}},mounted(){this.nodes=Array.from(this.$el.childNodes),this.disabled||this.bootObserver(),this.maybeMove()},beforeUnmount(){this.disable(),this.teardownObserver()},methods:{maybeMove(){this.disabled?console.log(this.$el):this.move()},move(){if(this.waiting=!1,this.parent=document.querySelector(this.to),!this.parent){this.disable(),this.waiting=!0;return}this.where==="before"?this.parent.prepend(this.getFragment()):this.parent.appendChild(this.getFragment())},disable(){this.$el.appendChild(this.getFragment()),this.parent=null},getFragment(){const e=document.createDocumentFragment();return this.nodes.forEach(t=>e.appendChild(t)),e},onMutations(e){let t=!1;for(let i=0;i<e.length;i++){const r=e[i],a=Array.from(r.addedNodes).filter(n=>!this.nodes.includes(n));Array.from(r.removedNodes).includes(this.parent)?(this.disable(),this.waiting=!this.disabled):this.waiting&&a.length>0&&(t=!0)}t&&this.move()},bootObserver(){this.observer||(this.observer=new MutationObserver(e=>this.onMutations(e)),this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!1,characterData:!1}))},teardownObserver(){this.observer&&(this.observer.disconnect(),this.observer=null)}}},V=(e,t)=>{const i=e.__vccOpts||e;for(const[r,a]of t)i[r]=a;return i};function nt(e,t,i,r,a,n){return T(),j("div",{class:it(n.classes)},[I(e.$slots,"default")],2)}const D=V(rt,[["render",nt]]);let ot=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,i)=>(i&=63,i<36?t+=i.toString(36):i<62?t+=(i-26).toString(36).toUpperCase():i>62?t+="-":t+="_",t),"");var C=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function dt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var lt="Expected a function",F=0/0,st="[object Symbol]",ht=/^\s+|\s+$/g,ct=/^[-+]0x[0-9a-f]+$/i,vt=/^0b[01]+$/i,ut=/^0o[0-7]+$/i,mt=parseInt,ft=typeof C=="object"&&C&&C.Object===Object&&C,yt=typeof self=="object"&&self&&self.Object===Object&&self,pt=ft||yt||Function("return this")(),gt=Object.prototype,bt=gt.toString,wt=Math.max,xt=Math.min,M=function(){return pt.Date.now()};function St(e,t,i){var r,a,n,o,d,l,s=0,u=!1,c=!1,m=!0;if(typeof e!="function")throw new TypeError(lt);t=G(t)||0,N(i)&&(u=!!i.leading,c="maxWait"in i,n=c?wt(G(i.maxWait)||0,t):n,m="trailing"in i?!!i.trailing:m);function y(v){var S=r,_=a;return r=a=void 0,s=v,o=e.apply(_,S),o}function b(v){return s=v,d=setTimeout(g,t),u?y(v):o}function w(v){var S=v-l,_=v-s,P=t-S;return c?xt(P,n-_):P}function p(v){var S=v-l,_=v-s;return l===void 0||S>=t||S<0||c&&_>=n}function g(){var v=M();if(p(v))return x(v);d=setTimeout(g,w(v))}function x(v){return d=void 0,m&&r?y(v):(r=a=void 0,o)}function $(){d!==void 0&&clearTimeout(d),s=0,r=l=a=d=void 0}function L(){return d===void 0?o:x(M())}function O(){var v=M(),S=p(v);if(r=arguments,a=this,l=v,S){if(d===void 0)return b(l);if(c)return d=setTimeout(g,t),y(l)}return d===void 0&&(d=setTimeout(g,t)),o}return O.cancel=$,O.flush=L,O}function N(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function kt(e){return!!e&&typeof e=="object"}function _t(e){return typeof e=="symbol"||kt(e)&&bt.call(e)==st}function G(e){if(typeof e=="number")return e;if(_t(e))return F;if(N(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=N(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(ht,"");var i=vt.test(e);return i||ut.test(e)?mt(e.slice(2),i?2:8):ct.test(e)?F:+e}var Ot=St;const X=dt(Ot);var Pt=function(t){return typeof t=="function"},k=function(t){return t===void 0},$t=function(t,i,r){return Array.from({length:t},function(){return new Array(i).fill(r)})},f=function(t,i){return k(t)?i:t},Y=function(e,t,i){t===void 0&&(t=void 0),i===void 0&&(i=void 0);var r=new Image;return r.setAttribute("crossOrigin","Anonymous"),!k(t)&&(r.width=t),!k(i)&&(r.height=i),r.src=e,new Promise(function(a){r.onload=function(){a(r)}})},Lt=function(e){var t=e.outerHTML.replace(/\n/g,"").replace(/\t/g,"").replace(/#/g,"%23");return"data:image/svg+xml;charset=utf-8,".concat(t)},q=function(e,t,i){t===void 0&&(t={}),i===void 0&&(i="http://www.w3.org/2000/svg");var r=document.createElementNS(i,e);for(var a in t)r.setAttribute(a,t[a]);return r},Tt=function(e,t){var i=q("svg",{xmlns:"http://www.w3.org/2000/svg"}),r=document.createElement("div");r.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),r.style.cssText=`
  text-align: center;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  font: `.concat(e.font,`;
  color: `).concat(t.fontColor,`;
`),r.innerHTML='<div class="rich-text-content">'.concat(t.content,"</div>"),document.body.appendChild(r);var a=r.querySelector(".rich-text-content"),n=a.offsetHeight,o=a.offsetWidth;document.body.removeChild(r);var d=t.richTextWidth||o||t.width,l=t.richTextHeight||n||t.height;i.setAttribute("width",d.toString()),i.setAttribute("height",l.toString());var s=q("foreignObject",{width:d.toString(),height:l.toString()});return s.appendChild(r),i.appendChild(s),{element:i,width:d,height:l}},Ct=function(e){return e.toDataURL("image/png",1)},Wt=function(e,t,i){for(var r=[],a="",n=0,o=t.length;n<o;n++)a+=t.charAt(n),e.measureText(a).width>i&&(r.push(a.substring(0,a.length-1)),a="",n--);return r.push(a),r},h={width:300,height:300,rotate:45,layout:"default",auxiliaryLine:!1,translatePlacement:"middle",contentType:"text",content:"hello watermark-js-plus",textType:"fill",imageWidth:0,imageHeight:0,lineHeight:30,zIndex:2147483647,backgroundPosition:"0 0",backgroundRepeat:"repeat",fontSize:"20px",fontFamily:"sans-serif",fontStyle:"",fontVariant:"",fontColor:"#000",fontWeight:"normal",filter:"none",globalAlpha:.5,mode:"default",mutationObserve:!0,movable:!1,parent:"body",onSuccess:function(){},onBeforeDestroy:function(){},onDestroyed:function(){},onObserveError:function(){}},Ht=function(e,t,i){var r=e.getContext("2d");if(r===null)throw new Error("get context error");r.font="".concat(t.fontStyle," ").concat(t.fontVariant," ").concat(t.fontWeight," ").concat(t.fontSize," ").concat(t.fontFamily),r.filter=t.filter,t!=null&&t.rotate&&(t.rotate=(360-t.rotate%360)*(Math.PI/180)),k(i.textRowMaxWidth)&&(t.textRowMaxWidth=t.width);var a={image:{rect:{width:t.imageWidth,height:t.imageHeight},position:{x:0,y:0}},textLine:{data:[],yOffsetValue:0},advancedStyleParams:{linear:{x0:0,x1:0},radial:{x0:0,y0:0,r0:0,x1:0,y1:0,r1:0},conic:{x:0,y:0,startAngle:0},pattern:{}}};switch(t.contentType){case"text":a.textLine.data=[t.content];break;case"multi-line-text":a.textLine.data=Wt(r,t.content,t.textRowMaxWidth);break}var n=t.width/2,o=t.height/2,d="middle",l="center";switch(!k(i==null?void 0:i.translateX)&&!k(i==null?void 0:i.translateY)?(n=i==null?void 0:i.translateX,o=i==null?void 0:i.translateY,d="top",l="left"):(a.advancedStyleParams.linear.x0=-t.width/2,a.advancedStyleParams.linear.x1=t.width/2,a.advancedStyleParams.radial.r0=0,a.advancedStyleParams.radial.r1=t.width/2),i.translatePlacement){case"top":n=t.width/2,o=0,d="top",a.advancedStyleParams.linear.x0=-t.width/2,a.advancedStyleParams.linear.x1=t.width/2,a.advancedStyleParams.radial.y0=a.textLine.data.length*t.lineHeight/2,a.advancedStyleParams.radial.y1=a.textLine.data.length*t.lineHeight/2,a.advancedStyleParams.conic.y=a.textLine.data.length*t.lineHeight/2;break;case"top-start":n=0,o=0,d="top",l="start",a.advancedStyleParams.linear.x0=0,a.advancedStyleParams.linear.x1=t.width,a.advancedStyleParams.radial.x0=t.width/2,a.advancedStyleParams.radial.y0=a.textLine.data.length*t.lineHeight/2,a.advancedStyleParams.radial.x1=t.width/2,a.advancedStyleParams.radial.y1=a.textLine.data.length*t.lineHeight/2,a.advancedStyleParams.conic.x=t.width/2,a.advancedStyleParams.conic.y=a.textLine.data.length*t.lineHeight/2;break;case"top-end":n=t.width,o=0,d="top",l="end",a.advancedStyleParams.linear.x0=0,a.advancedStyleParams.linear.x1=-t.width,a.advancedStyleParams.radial.x0=-t.width/2,a.advancedStyleParams.radial.y0=a.textLine.data.length*t.lineHeight/2,a.advancedStyleParams.radial.x1=-t.width/2,a.advancedStyleParams.radial.y1=a.textLine.data.length*t.lineHeight/2,a.advancedStyleParams.conic.x=-t.width/2,a.advancedStyleParams.conic.y=a.textLine.data.length*t.lineHeight/2;break;case"bottom":n=t.width/2,o=t.height,d="bottom",a.advancedStyleParams.linear.x0=-t.width/2,a.advancedStyleParams.linear.x1=t.width/2,a.advancedStyleParams.radial.y0=-a.textLine.data.length*t.lineHeight/2,a.advancedStyleParams.radial.y1=-a.textLine.data.length*t.lineHeight/2,a.advancedStyleParams.conic.x=0,a.advancedStyleParams.conic.y=-a.textLine.data.length*t.lineHeight/2;break;case"bottom-start":n=0,o=t.height,d="bottom",l="start",a.advancedStyleParams.linear.x0=0,a.advancedStyleParams.linear.x1=t.width,a.advancedStyleParams.radial.x0=t.width/2,a.advancedStyleParams.radial.y0=-a.textLine.data.length*t.lineHeight/2,a.advancedStyleParams.radial.x1=t.width/2,a.advancedStyleParams.radial.y1=-a.textLine.data.length*t.lineHeight/2,a.advancedStyleParams.conic.x=t.width/2,a.advancedStyleParams.conic.y=-a.textLine.data.length*t.lineHeight/2;break;case"bottom-end":n=t.width,o=t.height,d="bottom",l="end",a.advancedStyleParams.linear.x0=0,a.advancedStyleParams.linear.x1=-t.width,a.advancedStyleParams.radial.x0=-t.width/2,a.advancedStyleParams.radial.y0=-a.textLine.data.length*t.lineHeight/2,a.advancedStyleParams.radial.x1=-t.width/2,a.advancedStyleParams.radial.y1=-a.textLine.data.length*t.lineHeight/2,a.advancedStyleParams.conic.x=-t.width/2,a.advancedStyleParams.conic.y=-a.textLine.data.length*t.lineHeight/2;break;case"left":n=0,o=t.height/2,l="start",a.advancedStyleParams.linear.x0=0,a.advancedStyleParams.linear.x1=t.width,a.advancedStyleParams.radial.x0=t.width/2,a.advancedStyleParams.radial.x1=t.width/2,a.advancedStyleParams.conic.x=t.width/2,a.advancedStyleParams.conic.y=0;break;case"right":n=t.width,o=t.height/2,l="end",a.advancedStyleParams.linear.x0=0,a.advancedStyleParams.linear.x1=-t.width,a.advancedStyleParams.radial.x0=-t.width/2,a.advancedStyleParams.radial.x1=-t.width/2,a.advancedStyleParams.conic.x=-t.width/2,a.advancedStyleParams.conic.y=0;break}if(t.translateX=n,t.translateY=o,k(i==null?void 0:i.textBaseline)&&(t.textBaseline=d),k(i==null?void 0:i.textAlign)&&(t.textAlign=l),["text","multi-line-text"].indexOf(t.contentType)>-1)switch(t.textBaseline){case"middle":a.textLine.yOffsetValue=(a.textLine.data.length-1)*t.lineHeight/2;break;case"bottom":case"alphabetic":case"ideographic":a.textLine.yOffsetValue=(a.textLine.data.length-1)*t.lineHeight+(t.lineHeight-parseInt(t.fontSize))/2;break;case"top":case"hanging":a.textLine.yOffsetValue=-t.lineHeight/2+parseInt(t.fontSize)/2;break}return a},et=function(){function e(t,i){this.props=t,this.options=i,this.canvas=e.createCanvas(this.options.width,this.options.height),this.recommendOptions=Ht(this.canvas,this.options,this.props)}return e.createCanvas=function(t,i){var r,a=window.devicePixelRatio||1,n=document.createElement("canvas");return n.width=t*a,n.height=i*a,n.style.width="".concat(t,"px"),n.style.height="".concat(i,"px"),(r=n.getContext("2d"))===null||r===void 0||r.setTransform(a,0,0,a,0,0),n},e.clearCanvas=function(t){var i=t.getContext("2d");if(i===null)throw new Error("get context error");i.restore(),i.clearRect(0,0,t.width,t.height)},e.prototype.getCanvas=function(){return this.canvas},e.prototype.clear=function(){e.clearCanvas(this.canvas)},e.prototype.draw=function(){var t=this,i=this.canvas.getContext("2d");if(i===null)throw new Error("get context error");return this.options.auxiliaryLine&&(i.beginPath(),i.rect(0,0,this.options.width,this.options.height),i.lineWidth=1,i.strokeStyle="#000",i.stroke(),i.closePath(),i.beginPath(),i.rect(this.options.translateX,this.options.translateY,1,1),i.lineWidth=1,i.strokeStyle="#f00",i.stroke(),i.closePath()),this.setStyle(i),i.save(),i.translate(this.options.translateX,this.options.translateY),i.rotate(this.options.rotate),new Promise(function(r){switch(t.options.contentType){case"text":t.drawText(i,r);break;case"image":t.drawImage(i,r);break;case"multi-line-text":t.drawMultiLineText(i,r);break;case"rich-text":t.drawRichText(i,r);break}})},e.prototype.setStyle=function(t){var i,r="fillStyle";this.options.textType==="stroke"&&(r="strokeStyle");var a=this.options.fontColor;if(!((i=this.options)===null||i===void 0)&&i.advancedStyle)switch(this.options.advancedStyle.type){case"linear":a=this.createLinearGradient(t);break;case"radial":a=this.createRadialGradient(t);break;case"conic":a=this.createConicGradient(t);break;case"pattern":a=this.createPattern(t);break}t[r]&&a&&(t[r]=a),this.options.textAlign&&(t.textAlign=this.options.textAlign),this.options.textBaseline&&(t.textBaseline=this.options.textBaseline),t.globalAlpha=this.options.globalAlpha,this.options.shadowStyle&&(t.shadowBlur=f(this.options.shadowStyle.shadowBlur,0),t.shadowColor=f(this.options.shadowStyle.shadowColor,"#00000000"),t.shadowOffsetX=f(this.options.shadowStyle.shadowOffsetX,0),t.shadowOffsetY=f(this.options.shadowStyle.shadowOffsetY,0)),Pt(this.options.extraDrawFunc)&&this.options.extraDrawFunc(t)},e.prototype.createLinearGradient=function(t){var i,r,a,n,o,d,l,s,u,c,m,y,b,w,p,g=t.createLinearGradient(f((a=(r=(i=this.options.advancedStyle)===null||i===void 0?void 0:i.params)===null||r===void 0?void 0:r.linear)===null||a===void 0?void 0:a.x0,this.recommendOptions.advancedStyleParams.linear.x0),f((d=(o=(n=this.options.advancedStyle)===null||n===void 0?void 0:n.params)===null||o===void 0?void 0:o.linear)===null||d===void 0?void 0:d.y0,0),f((u=(s=(l=this.options.advancedStyle)===null||l===void 0?void 0:l.params)===null||s===void 0?void 0:s.linear)===null||u===void 0?void 0:u.x1,this.recommendOptions.advancedStyleParams.linear.x1),f((y=(m=(c=this.options.advancedStyle)===null||c===void 0?void 0:c.params)===null||m===void 0?void 0:m.linear)===null||y===void 0?void 0:y.y1,0));return(p=(w=(b=this.options)===null||b===void 0?void 0:b.advancedStyle)===null||w===void 0?void 0:w.colorStops)===null||p===void 0||p.forEach(function(x){g.addColorStop(x.offset,x.color)}),g},e.prototype.createConicGradient=function(t){var i,r,a,n,o,d,l,s,u,c,m,y,b,w,p,g=t.createConicGradient(f((n=(a=(r=(i=this.options)===null||i===void 0?void 0:i.advancedStyle)===null||r===void 0?void 0:r.params)===null||a===void 0?void 0:a.conic)===null||n===void 0?void 0:n.startAngle,0),f((s=(l=(d=(o=this.options)===null||o===void 0?void 0:o.advancedStyle)===null||d===void 0?void 0:d.params)===null||l===void 0?void 0:l.conic)===null||s===void 0?void 0:s.x,this.recommendOptions.advancedStyleParams.conic.x),f((y=(m=(c=(u=this.options)===null||u===void 0?void 0:u.advancedStyle)===null||c===void 0?void 0:c.params)===null||m===void 0?void 0:m.conic)===null||y===void 0?void 0:y.y,this.recommendOptions.advancedStyleParams.conic.y));return(p=(w=(b=this.options)===null||b===void 0?void 0:b.advancedStyle)===null||w===void 0?void 0:w.colorStops)===null||p===void 0||p.forEach(function(x){g.addColorStop(x.offset,x.color)}),g},e.prototype.createRadialGradient=function(t){var i,r,a,n,o,d,l,s,u,c,m,y,b,w,p,g,x,$,L,O,v,S,_,P,A,B,E,R=t.createRadialGradient(f((n=(a=(r=(i=this.options)===null||i===void 0?void 0:i.advancedStyle)===null||r===void 0?void 0:r.params)===null||a===void 0?void 0:a.radial)===null||n===void 0?void 0:n.x0,this.recommendOptions.advancedStyleParams.radial.x0),f((s=(l=(d=(o=this.options)===null||o===void 0?void 0:o.advancedStyle)===null||d===void 0?void 0:d.params)===null||l===void 0?void 0:l.radial)===null||s===void 0?void 0:s.y0,this.recommendOptions.advancedStyleParams.radial.y0),f((y=(m=(c=(u=this.options)===null||u===void 0?void 0:u.advancedStyle)===null||c===void 0?void 0:c.params)===null||m===void 0?void 0:m.radial)===null||y===void 0?void 0:y.r0,this.recommendOptions.advancedStyleParams.radial.r0),f((g=(p=(w=(b=this.options)===null||b===void 0?void 0:b.advancedStyle)===null||w===void 0?void 0:w.params)===null||p===void 0?void 0:p.radial)===null||g===void 0?void 0:g.x1,this.recommendOptions.advancedStyleParams.radial.x1),f((O=(L=($=(x=this.options)===null||x===void 0?void 0:x.advancedStyle)===null||$===void 0?void 0:$.params)===null||L===void 0?void 0:L.radial)===null||O===void 0?void 0:O.y1,this.recommendOptions.advancedStyleParams.radial.y1),f((P=(_=(S=(v=this.options)===null||v===void 0?void 0:v.advancedStyle)===null||S===void 0?void 0:S.params)===null||_===void 0?void 0:_.radial)===null||P===void 0?void 0:P.r1,this.recommendOptions.advancedStyleParams.radial.r1));return(E=(B=(A=this.options)===null||A===void 0?void 0:A.advancedStyle)===null||B===void 0?void 0:B.colorStops)===null||E===void 0||E.forEach(function(z){R.addColorStop(z.offset,z.color)}),R},e.prototype.createPattern=function(t){var i,r,a,n,o,d,l,s;return t.createPattern((n=(a=(r=(i=this.options)===null||i===void 0?void 0:i.advancedStyle)===null||r===void 0?void 0:r.params)===null||a===void 0?void 0:a.pattern)===null||n===void 0?void 0:n.image,((s=(l=(d=(o=this.options)===null||o===void 0?void 0:o.advancedStyle)===null||d===void 0?void 0:d.params)===null||l===void 0?void 0:l.pattern)===null||s===void 0?void 0:s.repetition)||"")},e.prototype.setText=function(t,i){var r="fillText";this.options.textType==="stroke"&&(r="strokeText"),t[r]&&t[r](i.text,i.x,i.y,i.maxWidth)},e.prototype.drawText=function(t,i){this.setText(t,{text:this.options.content,x:0,y:0-this.recommendOptions.textLine.yOffsetValue,maxWidth:this.options.textRowMaxWidth||this.options.width}),i(t.canvas)},e.prototype.drawImage=function(t,i){var r=this;Y(this.options.image).then(function(a){var n=r.getImageRect(a),o=n.width,d=n.height,l=r.getDrawImagePosition(o,d);t.drawImage(a,l.x,l.y,o,d),i(t.canvas)})},e.prototype.drawMultiLineText=function(t,i){var r=this,a=this.recommendOptions.textLine.data,n=this.recommendOptions.textLine.yOffsetValue;a.forEach(function(o,d){r.setText(t,{text:o,x:0,y:r.options.lineHeight*d-n})}),i(t.canvas)},e.prototype.drawRichText=function(t,i){var r=this,a=Tt(t,this.options);Y(Lt(a.element),a.width,a.height).then(function(n){var o=r.getDrawImagePosition(n.width,n.height);t.drawImage(n,o.x,o.y,n.width,n.height),i(t.canvas)})},e.prototype.getImageRect=function(t){var i={width:this.options.imageWidth||0,height:this.options.imageHeight||0};switch(!0){case(i.width!==0&&i.height===0):i.height=i.width*t.height/t.width;break;case(i.width===0&&i.height!==0):i.width=i.height*t.width/t.height;break;case(i.width===0&&i.height===0):i.width=t.width,i.height=t.height;break}return i},e.prototype.getDrawImagePosition=function(t,i){var r,a,n={x:-t/2,y:-i/2};switch(this.options.translatePlacement){case"top":n.x=-t/2,n.y=0;break;case"top-start":n.x=0,n.y=0;break;case"top-end":n.x=-t,n.y=0;break;case"bottom":n.x=-t/2,n.y=-i;break;case"bottom-start":n.x=0,n.y=-i;break;case"bottom-end":n.x=-t,n.y=-i;break;case"left":n.x=0,n.y=-i/2;break;case"right":n.x=-t,n.y=-i/2;break}return!k((r=this.props)===null||r===void 0?void 0:r.translateX)&&(n.x=0),!k((a=this.props)===null||a===void 0?void 0:a.translateY)&&(n.y=0),n},e}(),At=function(){function e(t,i){var r,a,n,o;this.options=t,this.partialWidth=this.options.width,this.partialHeight=this.options.height,this.rows=((r=this.options.gridLayoutOptions)===null||r===void 0?void 0:r.rows)||1,this.cols=((a=this.options.gridLayoutOptions)===null||a===void 0?void 0:a.cols)||1,this.matrix=((n=this.options.gridLayoutOptions)===null||n===void 0?void 0:n.matrix)||$t(this.rows,this.cols,1),this.gap=((o=this.options.gridLayoutOptions)===null||o===void 0?void 0:o.gap)||[0,0],this.partialCanvas=i}return e.prototype.draw=function(){var t,i,r,a,n,o,d,l,s=et.createCanvas(((t=this.options.gridLayoutOptions)===null||t===void 0?void 0:t.width)||this.partialWidth*this.cols+this.gap[0]*this.cols,((i=this.options.gridLayoutOptions)===null||i===void 0?void 0:i.height)||this.partialHeight*this.rows+this.gap[1]*this.rows),u=s.getContext("2d");!((r=this.options.gridLayoutOptions)===null||r===void 0)&&r.backgroundImage&&(u==null||u.drawImage((a=this.options.gridLayoutOptions)===null||a===void 0?void 0:a.backgroundImage,0,0,(n=this.options.gridLayoutOptions)===null||n===void 0?void 0:n.width,(o=this.options.gridLayoutOptions)===null||o===void 0?void 0:o.height));for(var c=0;c<this.rows;c++)for(var m=0;m<this.cols;m++)!((l=(d=this.matrix)===null||d===void 0?void 0:d[c])===null||l===void 0)&&l[m]&&(u==null||u.drawImage(this.partialCanvas,this.partialWidth*m+this.gap[0]*m,this.partialHeight*c+this.gap[1]*c,this.partialWidth,this.partialHeight));return s},e}(),Bt=function(e,t){switch(e.layout){case"grid":return new At(e,t).draw();default:return t}},Et=function(e){var t,i,r;switch(e.layout){case"grid":{var a=((t=e.gridLayoutOptions)===null||t===void 0?void 0:t.cols)||1,n=((i=e.gridLayoutOptions)===null||i===void 0?void 0:i.rows)||1,o=((r=e.gridLayoutOptions)===null||r===void 0?void 0:r.gap)||[0,0];return[e.width*a+o[0]*a,e.height*n+o[1]*n]}default:return[e.width,e.height]}};const at={props:{width:{type:Number,default:h.width},height:{type:Number,default:h.height},rotate:{type:Number,default:h.rotate},layout:{type:String,default:h.layout},gridLayoutOptions:{type:Object,default:void 0},auxiliaryLine:{type:Boolean,default:h.auxiliaryLine},globalAlpha:{type:Number,default:h.globalAlpha},zIndex:{type:Number,default:10},mutationObserve:{type:Boolean,default:!1},movable:{type:Boolean,default:h.movable},mode:{type:String,default:h.mode},backgroundPosition:{type:String,default:h.backgroundPosition},backgroundRepeat:{type:String,default:h.backgroundRepeat},translatePlacement:{type:String,default:void 0},translateX:{type:Number,default:void 0},translateY:{type:Number,default:void 0},contentType:{type:String,default:h.contentType},content:{type:String,default:h.content},textType:{type:String,default:h.textType},lineHeight:{type:Number,default:h.lineHeight},fontSize:{type:String,default:h.fontSize},fontFamily:{type:String,default:h.fontFamily},fontStyle:{type:String,default:h.fontStyle},fontVariant:{type:String,default:h.fontVariant},fontColor:{type:String,default:h.fontColor},fontWeight:{type:String,default:h.fontWeight},textAlign:{type:String,default:void 0},textBaseline:{type:String,default:void 0},filter:{type:String,default:h.filter},textRowMaxWidth:{type:Number,default:void 0},richTextWidth:{type:Number,default:void 0},richTextHeight:{type:Number,default:void 0},image:{type:String,default:void 0},imageWidth:{type:Number,default:h.imageWidth},imageHeight:{type:Number,default:h.imageHeight},shadowStyle:{type:Object,default:void 0},advancedStyle:{type:Object,default:void 0},appendToBody:{type:Boolean,default:!1}},emits:["success","error","beforeDestroy","destroyed","observeSuccess","observeError"],data(){return{key:"",watermarkCanvas:null,watermarkImage:"",observer:null,parentObserve:null,observing:!1}},computed:{options(){return{...h,...this.$props}},watermarkWrapperStyle(){const e=this.mutationObserve?"!important":"";return{...this.mutationObserve&&{"z-index":`${this.zIndex}${e}`,display:`block${e}`,visibility:`visible${e}`,transform:`none${e}`,scale:`none${e}`},position:`relative${e}`}},watermarkStyle(){const e=this.mutationObserve?"!important":"",t=Et({layout:this.layout,width:this.width,height:this.height,gridLayoutOptions:this.gridLayoutOptions});return{...this.mutationObserve&&{visibility:`visible${e}`,transform:`none${e}`,scale:`none${e}`},"z-index":`${this.zIndex}${e}`,display:`block${e}`,width:`100%${e}`,height:`100%${e}`,"pointer-events":`none${e}`,left:`0${e}`,right:`0${e}`,top:`0${e}`,bottom:`0${e}`,position:`${this.appendToBody?"fixed":"absolute"}${e}`,"background-image":`url(${this.watermarkImage})${e}`,"background-repeat":`${this.backgroundRepeat}${e}`,"background-size":`${t[0]}px ${t[1]}px${e}`,"background-position":`${this.backgroundPosition}${e}`,...this.movable&&{animation:`200s ease 0s infinite normal none running watermark ${e}`}}}},watch:{options:{deep:!0,handler:async function(){await this.create()}}},created(){},async mounted(){await this.create(),this.$emit("success")},methods:{generateKey(){return this.mutationObserve?ot(6):"watermark"},create:X(async function(){this.watermarkCanvas=new et(this.$props,this.options),this.remove(),this.key=this.generateKey();try{await this.$nextTick(()=>{this.draw()})}catch{this.$emit("error")}},10),update:X(async function(){this.remove(),this.key=this.generateKey();try{await this.$nextTick(()=>{this.draw()})}catch{this.$emit("error")}},10),async draw(){var e,t,i;this.mutationObserve&&(this.$refs.watermarkWrapperRef.id=`watermark-${this.key}`),await((e=this.watermarkCanvas)==null?void 0:e.draw());const r=Bt(this.options,(t=this.watermarkCanvas)==null?void 0:t.getCanvas());this.watermarkImage=Ct(r),(i=this.watermarkCanvas)==null||i.clear(),await this.$nextTick(()=>{this.handleObserver()})},remove(){var e;this.$emit("beforeDestroy"),this.removeObserver(),this.mutationObserve&&((e=document.querySelector(`#watermark-${this.key}`))==null||e.remove()),this.$emit("destroyed")},handleObserver(){if(!this.mutationObserve){this.observing=!1;return}try{!this.observing&&this.addObserver(),this.observing=!0,this.$emit("observeSuccess")}catch{this.$emit("observeError"),this.observing=!1}},addObserver(){const e=this.$refs.watermarkWrapperRef,t=e.parentElement;this.observer=new MutationObserver(async i=>{i.length>0&&await this.update()}),this.observer.observe(e,{attributes:!0,childList:!0,subtree:!1,characterData:!0}),this.parentObserve=new MutationObserver(async i=>{var r;for(const a of i)((a==null?void 0:a.target)===e||((r=a==null?void 0:a.removedNodes)==null?void 0:r[0])===e||a.type==="childList"&&a.target===t&&a.target.lastChild!==e)&&await this.update()}),this.parentObserve.observe(t,{attributes:!0,childList:!0,subtree:!0,characterData:!0})},removeObserver(){var e,t;(e=this.observer)==null||e.disconnect(),(t=this.parentObserve)==null||t.disconnect(),this.observing=!1}}},Mt=J({name:"Watermark",directives:{},mixins:[at],props:{modelValue:{type:Boolean,default:!0}},emits:["update:modelValue"],data(){return{}},computed:{},watch:{modelValue(e){e?this.handleObserver():this.removeObserver()}},created(){},mounted(){},methods:{}});function Nt(e,t,i,r,a,n){return e.key?(T(),Q(tt,{to:"body",disabled:!e.appendToBody,key:e.key},[Z("div",{style:W(e.watermarkWrapperStyle),ref:"watermarkWrapperRef"},[I(e.$slots,"default"),e.modelValue?(T(),j("div",{key:0,style:W(e.watermarkStyle)},null,4)):H("",!0)],4)],8,["disabled"])):H("",!0)}const U=V(Mt,[["render",Nt]]),jt=J({name:"BlindWatermark",directives:{},mixins:[at],props:{globalAlpha:{type:Number,default:.005},mode:{type:String,default:"blind"},modelValue:{type:Boolean,default:!0}},emits:["update:modelValue"],data(){return{}},computed:{},watch:{modelValue(e){e?this.handleObserver():this.removeObserver()}},created(){},mounted(){},methods:{}});function It(e,t,i,r,a,n){return e.key?(T(),Q(tt,{to:"body",disabled:!e.appendToBody,key:e.key},[Z("div",{style:W(e.watermarkWrapperStyle),ref:"watermarkWrapperRef"},[I(e.$slots,"default"),e.modelValue?(T(),j("div",{key:0,style:W(e.watermarkStyle)},null,4)):H("",!0)],4)],8,["disabled"])):H("",!0)}const K=V(jt,[["render",It]]),Rt={install(e){e.component(U.name,U),e.component(K.name,K),e.component(D.name,D)}};export{Rt as default,D as teleport,U as watermark};
