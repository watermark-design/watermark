import{d as J,o as E,c as Y,r as q,n as Q,b as Z,k as tt,N,e as B,aw as et}from"./framework.d311ac02.js";const at={name:"Teleport",props:{to:{type:String,required:!0},where:{type:String,default:"after"},disabled:Boolean},data(){return{nodes:[],waiting:!1,observer:null,parent:null}},computed:{classes(){return this.disabled?["teleport"]:["teleport","teleport-hidden"]}},watch:{to:"maybeMove",where:"maybeMove",disabled(i){i?(this.disable(),this.teardownObserver()):(this.bootObserver(),this.move())}},mounted(){this.nodes=Array.from(this.$el.childNodes),this.disabled||this.bootObserver(),this.maybeMove()},beforeUnmount(){this.disable(),this.teardownObserver()},methods:{maybeMove(){this.disabled?console.log(this.$el):this.move()},move(){if(this.waiting=!1,this.parent=document.querySelector(this.to),!this.parent){this.disable(),this.waiting=!0;return}this.where==="before"?this.parent.prepend(this.getFragment()):this.parent.appendChild(this.getFragment())},disable(){this.$el.appendChild(this.getFragment()),this.parent=null},getFragment(){const i=document.createDocumentFragment();return this.nodes.forEach(t=>i.appendChild(t)),i},onMutations(i){let t=!1;for(let a=0;a<i.length;a++){const r=i[a],e=Array.from(r.addedNodes).filter(n=>!this.nodes.includes(n));Array.from(r.removedNodes).includes(this.parent)?(this.disable(),this.waiting=!this.disabled):this.waiting&&e.length>0&&(t=!0)}t&&this.move()},bootObserver(){this.observer||(this.observer=new MutationObserver(i=>this.onMutations(i)),this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!1,characterData:!1}))},teardownObserver(){this.observer&&(this.observer.disconnect(),this.observer=null)}}},U=(i,t)=>{const a=i.__vccOpts||i;for(const[r,e]of t)a[r]=e;return a};function it(i,t,a,r,e,n){return E(),Y("div",{class:Q(n.classes)},[q(i.$slots,"default")],2)}const R=U(at,[["render",it]]);let rt=(i=21)=>crypto.getRandomValues(new Uint8Array(i)).reduce((t,a)=>(a&=63,a<36?t+=a.toString(36):a<62?t+=(a-26).toString(36).toUpperCase():a>62?t+="-":t+="_",t),"");var C=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function nt(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var ot="Expected a function",V=0/0,dt="[object Symbol]",lt=/^\s+|\s+$/g,st=/^[-+]0x[0-9a-f]+$/i,ht=/^0b[01]+$/i,ct=/^0o[0-7]+$/i,vt=parseInt,ut=typeof C=="object"&&C&&C.Object===Object&&C,mt=typeof self=="object"&&self&&self.Object===Object&&self,ft=ut||mt||Function("return this")(),yt=Object.prototype,gt=yt.toString,pt=Math.max,bt=Math.min,A=function(){return ft.Date.now()};function wt(i,t,a){var r,e,n,o,d,l,s=0,u=!1,c=!1,m=!0;if(typeof i!="function")throw new TypeError(ot);t=z(t)||0,M(a)&&(u=!!a.leading,c="maxWait"in a,n=c?pt(z(a.maxWait)||0,t):n,m="trailing"in a?!!a.trailing:m);function y(v){var S=r,_=e;return r=e=void 0,s=v,o=i.apply(_,S),o}function b(v){return s=v,d=setTimeout(p,t),u?y(v):o}function w(v){var S=v-l,_=v-s,O=t-S;return c?bt(O,n-_):O}function g(v){var S=v-l,_=v-s;return l===void 0||S>=t||S<0||c&&_>=n}function p(){var v=A();if(g(v))return x(v);d=setTimeout(p,w(v))}function x(v){return d=void 0,m&&r?y(v):(r=e=void 0,o)}function L(){d!==void 0&&clearTimeout(d),s=0,r=l=e=d=void 0}function $(){return d===void 0?o:x(A())}function P(){var v=A(),S=g(v);if(r=arguments,e=this,l=v,S){if(d===void 0)return b(l);if(c)return d=setTimeout(p,t),y(l)}return d===void 0&&(d=setTimeout(p,t)),o}return P.cancel=L,P.flush=$,P}function M(i){var t=typeof i;return!!i&&(t=="object"||t=="function")}function xt(i){return!!i&&typeof i=="object"}function St(i){return typeof i=="symbol"||xt(i)&&gt.call(i)==dt}function z(i){if(typeof i=="number")return i;if(St(i))return V;if(M(i)){var t=typeof i.valueOf=="function"?i.valueOf():i;i=M(t)?t+"":t}if(typeof i!="string")return i===0?i:+i;i=i.replace(lt,"");var a=ht.test(i);return a||ct.test(i)?vt(i.slice(2),a?2:8):st.test(i)?V:+i}var kt=wt;const D=nt(kt);var _t=function(t){return typeof t=="function"},k=function(t){return t===void 0},Pt=function(t,a,r){return Array.from({length:t},function(){return new Array(a).fill(r)})},f=function(t,a){return k(t)?a:t},F=function(i,t,a){t===void 0&&(t=void 0),a===void 0&&(a=void 0);var r=new Image;return r.setAttribute("crossOrigin","Anonymous"),!k(t)&&(r.width=t),!k(a)&&(r.height=a),r.src=i,new Promise(function(e){r.onload=function(){e(r)}})},Ot=function(i){var t=i.outerHTML.replace(/\n/g,"").replace(/\t/g,"").replace(/#/g,"%23");return"data:image/svg+xml;charset=utf-8,".concat(t)},G=function(i,t,a){t===void 0&&(t={}),a===void 0&&(a="http://www.w3.org/2000/svg");var r=document.createElementNS(a,i);for(var e in t)r.setAttribute(e,t[e]);return r},Lt=function(i,t){var a=G("svg",{xmlns:"http://www.w3.org/2000/svg"}),r=document.createElement("div");r.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),r.style.cssText=`
  text-align: center;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  font: `.concat(i.font,`;
  color: `).concat(t.fontColor,`;
`),r.innerHTML='<div class="rich-text-content">'.concat(t.content,"</div>"),document.body.appendChild(r);var e=r.querySelector(".rich-text-content"),n=e.offsetHeight,o=e.offsetWidth;document.body.removeChild(r);var d=t.richTextWidth||o||t.width,l=t.richTextHeight||n||t.height;a.setAttribute("width",d.toString()),a.setAttribute("height",l.toString());var s=G("foreignObject",{width:d.toString(),height:l.toString()});return s.appendChild(r),a.appendChild(s),{element:a,width:d,height:l}},$t=function(i){return i.toDataURL("image/png",1)},Ct=function(i,t,a){for(var r=[],e="",n=0,o=t.length;n<o;n++)e+=t.charAt(n),i.measureText(e).width>a&&(r.push(e.substring(0,e.length-1)),e="",n--);return r.push(e),r},h={width:300,height:300,rotate:45,layout:"default",auxiliaryLine:!1,translatePlacement:"middle",contentType:"text",content:"hello watermark-js-plus",textType:"fill",imageWidth:0,imageHeight:0,lineHeight:30,zIndex:2147483647,backgroundPosition:"0 0",backgroundRepeat:"repeat",fontSize:"20px",fontFamily:"sans-serif",fontStyle:"",fontVariant:"",fontColor:"#000",fontWeight:"normal",filter:"none",globalAlpha:.5,mode:"default",mutationObserve:!0,movable:!1,parent:"body",onSuccess:function(){},onBeforeDestroy:function(){},onDestroyed:function(){},onObserveError:function(){}},Tt=function(i,t,a){var r=i.getContext("2d");if(r===null)throw new Error("get context error");r.font="".concat(t.fontStyle," ").concat(t.fontVariant," ").concat(t.fontWeight," ").concat(t.fontSize," ").concat(t.fontFamily),r.filter=t.filter,t!=null&&t.rotate&&(t.rotate=(360-t.rotate%360)*(Math.PI/180)),k(a.textRowMaxWidth)&&(t.textRowMaxWidth=t.width);var e={image:{rect:{width:t.imageWidth,height:t.imageHeight},position:{x:0,y:0}},textLine:{data:[],yOffsetValue:0},advancedStyleParams:{linear:{x0:0,x1:0},radial:{x0:0,y0:0,r0:0,x1:0,y1:0,r1:0},conic:{x:0,y:0,startAngle:0},pattern:{}}};switch(t.contentType){case"text":e.textLine.data=[t.content];break;case"multi-line-text":e.textLine.data=Ct(r,t.content,t.textRowMaxWidth);break}var n=t.width/2,o=t.height/2,d="middle",l="center";switch(!k(a==null?void 0:a.translateX)&&!k(a==null?void 0:a.translateY)?(n=a==null?void 0:a.translateX,o=a==null?void 0:a.translateY,d="top",l="left"):(e.advancedStyleParams.linear.x0=-t.width/2,e.advancedStyleParams.linear.x1=t.width/2,e.advancedStyleParams.radial.r0=0,e.advancedStyleParams.radial.r1=t.width/2),a.translatePlacement){case"top":n=t.width/2,o=0,d="top",e.advancedStyleParams.linear.x0=-t.width/2,e.advancedStyleParams.linear.x1=t.width/2,e.advancedStyleParams.radial.y0=e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.radial.y1=e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.conic.y=e.textLine.data.length*t.lineHeight/2;break;case"top-start":n=0,o=0,d="top",l="start",e.advancedStyleParams.linear.x0=0,e.advancedStyleParams.linear.x1=t.width,e.advancedStyleParams.radial.x0=t.width/2,e.advancedStyleParams.radial.y0=e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.radial.x1=t.width/2,e.advancedStyleParams.radial.y1=e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.conic.x=t.width/2,e.advancedStyleParams.conic.y=e.textLine.data.length*t.lineHeight/2;break;case"top-end":n=t.width,o=0,d="top",l="end",e.advancedStyleParams.linear.x0=0,e.advancedStyleParams.linear.x1=-t.width,e.advancedStyleParams.radial.x0=-t.width/2,e.advancedStyleParams.radial.y0=e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.radial.x1=-t.width/2,e.advancedStyleParams.radial.y1=e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.conic.x=-t.width/2,e.advancedStyleParams.conic.y=e.textLine.data.length*t.lineHeight/2;break;case"bottom":n=t.width/2,o=t.height,d="bottom",e.advancedStyleParams.linear.x0=-t.width/2,e.advancedStyleParams.linear.x1=t.width/2,e.advancedStyleParams.radial.y0=-e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.radial.y1=-e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.conic.x=0,e.advancedStyleParams.conic.y=-e.textLine.data.length*t.lineHeight/2;break;case"bottom-start":n=0,o=t.height,d="bottom",l="start",e.advancedStyleParams.linear.x0=0,e.advancedStyleParams.linear.x1=t.width,e.advancedStyleParams.radial.x0=t.width/2,e.advancedStyleParams.radial.y0=-e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.radial.x1=t.width/2,e.advancedStyleParams.radial.y1=-e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.conic.x=t.width/2,e.advancedStyleParams.conic.y=-e.textLine.data.length*t.lineHeight/2;break;case"bottom-end":n=t.width,o=t.height,d="bottom",l="end",e.advancedStyleParams.linear.x0=0,e.advancedStyleParams.linear.x1=-t.width,e.advancedStyleParams.radial.x0=-t.width/2,e.advancedStyleParams.radial.y0=-e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.radial.x1=-t.width/2,e.advancedStyleParams.radial.y1=-e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.conic.x=-t.width/2,e.advancedStyleParams.conic.y=-e.textLine.data.length*t.lineHeight/2;break;case"left":n=0,o=t.height/2,l="start",e.advancedStyleParams.linear.x0=0,e.advancedStyleParams.linear.x1=t.width,e.advancedStyleParams.radial.x0=t.width/2,e.advancedStyleParams.radial.x1=t.width/2,e.advancedStyleParams.conic.x=t.width/2,e.advancedStyleParams.conic.y=0;break;case"right":n=t.width,o=t.height/2,l="end",e.advancedStyleParams.linear.x0=0,e.advancedStyleParams.linear.x1=-t.width,e.advancedStyleParams.radial.x0=-t.width/2,e.advancedStyleParams.radial.x1=-t.width/2,e.advancedStyleParams.conic.x=-t.width/2,e.advancedStyleParams.conic.y=0;break}if(t.translateX=n,t.translateY=o,k(a==null?void 0:a.textBaseline)&&(t.textBaseline=d),k(a==null?void 0:a.textAlign)&&(t.textAlign=l),["text","multi-line-text"].indexOf(t.contentType)>-1)switch(t.textBaseline){case"middle":e.textLine.yOffsetValue=(e.textLine.data.length-1)*t.lineHeight/2;break;case"bottom":case"alphabetic":case"ideographic":e.textLine.yOffsetValue=(e.textLine.data.length-1)*t.lineHeight+(t.lineHeight-parseInt(t.fontSize))/2;break;case"top":case"hanging":e.textLine.yOffsetValue=-t.lineHeight/2+parseInt(t.fontSize)/2;break}return e},K=function(){function i(t,a){this.props=t,this.options=a,this.canvas=i.createCanvas(this.options.width,this.options.height),this.recommendOptions=Tt(this.canvas,this.options,this.props)}return i.createCanvas=function(t,a){var r,e=window.devicePixelRatio||1,n=document.createElement("canvas");return n.width=t*e,n.height=a*e,n.style.width="".concat(t,"px"),n.style.height="".concat(a,"px"),(r=n.getContext("2d"))===null||r===void 0||r.setTransform(e,0,0,e,0,0),n},i.clearCanvas=function(t){var a=t.getContext("2d");if(a===null)throw new Error("get context error");a.restore(),a.clearRect(0,0,t.width,t.height)},i.prototype.getCanvas=function(){return this.canvas},i.prototype.clear=function(){i.clearCanvas(this.canvas)},i.prototype.draw=function(){var t=this,a=this.canvas.getContext("2d");if(a===null)throw new Error("get context error");return this.options.auxiliaryLine&&(a.beginPath(),a.rect(0,0,this.options.width,this.options.height),a.lineWidth=1,a.strokeStyle="#000",a.stroke(),a.closePath(),a.beginPath(),a.rect(this.options.translateX,this.options.translateY,1,1),a.lineWidth=1,a.strokeStyle="#f00",a.stroke(),a.closePath()),this.setStyle(a),a.save(),a.translate(this.options.translateX,this.options.translateY),a.rotate(this.options.rotate),new Promise(function(r){switch(t.options.contentType){case"text":t.drawText(a,r);break;case"image":t.drawImage(a,r);break;case"multi-line-text":t.drawMultiLineText(a,r);break;case"rich-text":t.drawRichText(a,r);break}})},i.prototype.setStyle=function(t){var a,r="fillStyle";this.options.textType==="stroke"&&(r="strokeStyle");var e=this.options.fontColor;if(!((a=this.options)===null||a===void 0)&&a.advancedStyle)switch(this.options.advancedStyle.type){case"linear":e=this.createLinearGradient(t);break;case"radial":e=this.createRadialGradient(t);break;case"conic":e=this.createConicGradient(t);break;case"pattern":e=this.createPattern(t);break}t[r]&&e&&(t[r]=e),this.options.textAlign&&(t.textAlign=this.options.textAlign),this.options.textBaseline&&(t.textBaseline=this.options.textBaseline),t.globalAlpha=this.options.globalAlpha,this.options.shadowStyle&&(t.shadowBlur=f(this.options.shadowStyle.shadowBlur,0),t.shadowColor=f(this.options.shadowStyle.shadowColor,"#00000000"),t.shadowOffsetX=f(this.options.shadowStyle.shadowOffsetX,0),t.shadowOffsetY=f(this.options.shadowStyle.shadowOffsetY,0)),_t(this.options.extraDrawFunc)&&this.options.extraDrawFunc(t)},i.prototype.createLinearGradient=function(t){var a,r,e,n,o,d,l,s,u,c,m,y,b,w,g,p=t.createLinearGradient(f((e=(r=(a=this.options.advancedStyle)===null||a===void 0?void 0:a.params)===null||r===void 0?void 0:r.linear)===null||e===void 0?void 0:e.x0,this.recommendOptions.advancedStyleParams.linear.x0),f((d=(o=(n=this.options.advancedStyle)===null||n===void 0?void 0:n.params)===null||o===void 0?void 0:o.linear)===null||d===void 0?void 0:d.y0,0),f((u=(s=(l=this.options.advancedStyle)===null||l===void 0?void 0:l.params)===null||s===void 0?void 0:s.linear)===null||u===void 0?void 0:u.x1,this.recommendOptions.advancedStyleParams.linear.x1),f((y=(m=(c=this.options.advancedStyle)===null||c===void 0?void 0:c.params)===null||m===void 0?void 0:m.linear)===null||y===void 0?void 0:y.y1,0));return(g=(w=(b=this.options)===null||b===void 0?void 0:b.advancedStyle)===null||w===void 0?void 0:w.colorStops)===null||g===void 0||g.forEach(function(x){p.addColorStop(x.offset,x.color)}),p},i.prototype.createConicGradient=function(t){var a,r,e,n,o,d,l,s,u,c,m,y,b,w,g,p=t.createConicGradient(f((n=(e=(r=(a=this.options)===null||a===void 0?void 0:a.advancedStyle)===null||r===void 0?void 0:r.params)===null||e===void 0?void 0:e.conic)===null||n===void 0?void 0:n.startAngle,0),f((s=(l=(d=(o=this.options)===null||o===void 0?void 0:o.advancedStyle)===null||d===void 0?void 0:d.params)===null||l===void 0?void 0:l.conic)===null||s===void 0?void 0:s.x,this.recommendOptions.advancedStyleParams.conic.x),f((y=(m=(c=(u=this.options)===null||u===void 0?void 0:u.advancedStyle)===null||c===void 0?void 0:c.params)===null||m===void 0?void 0:m.conic)===null||y===void 0?void 0:y.y,this.recommendOptions.advancedStyleParams.conic.y));return(g=(w=(b=this.options)===null||b===void 0?void 0:b.advancedStyle)===null||w===void 0?void 0:w.colorStops)===null||g===void 0||g.forEach(function(x){p.addColorStop(x.offset,x.color)}),p},i.prototype.createRadialGradient=function(t){var a,r,e,n,o,d,l,s,u,c,m,y,b,w,g,p,x,L,$,P,v,S,_,O,T,H,W,j=t.createRadialGradient(f((n=(e=(r=(a=this.options)===null||a===void 0?void 0:a.advancedStyle)===null||r===void 0?void 0:r.params)===null||e===void 0?void 0:e.radial)===null||n===void 0?void 0:n.x0,this.recommendOptions.advancedStyleParams.radial.x0),f((s=(l=(d=(o=this.options)===null||o===void 0?void 0:o.advancedStyle)===null||d===void 0?void 0:d.params)===null||l===void 0?void 0:l.radial)===null||s===void 0?void 0:s.y0,this.recommendOptions.advancedStyleParams.radial.y0),f((y=(m=(c=(u=this.options)===null||u===void 0?void 0:u.advancedStyle)===null||c===void 0?void 0:c.params)===null||m===void 0?void 0:m.radial)===null||y===void 0?void 0:y.r0,this.recommendOptions.advancedStyleParams.radial.r0),f((p=(g=(w=(b=this.options)===null||b===void 0?void 0:b.advancedStyle)===null||w===void 0?void 0:w.params)===null||g===void 0?void 0:g.radial)===null||p===void 0?void 0:p.x1,this.recommendOptions.advancedStyleParams.radial.x1),f((P=($=(L=(x=this.options)===null||x===void 0?void 0:x.advancedStyle)===null||L===void 0?void 0:L.params)===null||$===void 0?void 0:$.radial)===null||P===void 0?void 0:P.y1,this.recommendOptions.advancedStyleParams.radial.y1),f((O=(_=(S=(v=this.options)===null||v===void 0?void 0:v.advancedStyle)===null||S===void 0?void 0:S.params)===null||_===void 0?void 0:_.radial)===null||O===void 0?void 0:O.r1,this.recommendOptions.advancedStyleParams.radial.r1));return(W=(H=(T=this.options)===null||T===void 0?void 0:T.advancedStyle)===null||H===void 0?void 0:H.colorStops)===null||W===void 0||W.forEach(function(I){j.addColorStop(I.offset,I.color)}),j},i.prototype.createPattern=function(t){var a,r,e,n,o,d,l,s;return t.createPattern((n=(e=(r=(a=this.options)===null||a===void 0?void 0:a.advancedStyle)===null||r===void 0?void 0:r.params)===null||e===void 0?void 0:e.pattern)===null||n===void 0?void 0:n.image,((s=(l=(d=(o=this.options)===null||o===void 0?void 0:o.advancedStyle)===null||d===void 0?void 0:d.params)===null||l===void 0?void 0:l.pattern)===null||s===void 0?void 0:s.repetition)||"")},i.prototype.setText=function(t,a){var r="fillText";this.options.textType==="stroke"&&(r="strokeText"),t[r]&&t[r](a.text,a.x,a.y,a.maxWidth)},i.prototype.drawText=function(t,a){this.setText(t,{text:this.options.content,x:0,y:0-this.recommendOptions.textLine.yOffsetValue,maxWidth:this.options.textRowMaxWidth||this.options.width}),a(t.canvas)},i.prototype.drawImage=function(t,a){var r=this;F(this.options.image).then(function(e){var n=r.getImageRect(e),o=n.width,d=n.height,l=r.getDrawImagePosition(o,d);t.drawImage(e,l.x,l.y,o,d),a(t.canvas)})},i.prototype.drawMultiLineText=function(t,a){var r=this,e=this.recommendOptions.textLine.data,n=this.recommendOptions.textLine.yOffsetValue;e.forEach(function(o,d){r.setText(t,{text:o,x:0,y:r.options.lineHeight*d-n})}),a(t.canvas)},i.prototype.drawRichText=function(t,a){var r=this,e=Lt(t,this.options);F(Ot(e.element),e.width,e.height).then(function(n){var o=r.getDrawImagePosition(n.width,n.height);t.drawImage(n,o.x,o.y,n.width,n.height),a(t.canvas)})},i.prototype.getImageRect=function(t){var a={width:this.options.imageWidth||0,height:this.options.imageHeight||0};switch(!0){case(a.width!==0&&a.height===0):a.height=a.width*t.height/t.width;break;case(a.width===0&&a.height!==0):a.width=a.height*t.width/t.height;break;case(a.width===0&&a.height===0):a.width=t.width,a.height=t.height;break}return a},i.prototype.getDrawImagePosition=function(t,a){var r,e,n={x:-t/2,y:-a/2};switch(this.options.translatePlacement){case"top":n.x=-t/2,n.y=0;break;case"top-start":n.x=0,n.y=0;break;case"top-end":n.x=-t,n.y=0;break;case"bottom":n.x=-t/2,n.y=-a;break;case"bottom-start":n.x=0,n.y=-a;break;case"bottom-end":n.x=-t,n.y=-a;break;case"left":n.x=0,n.y=-a/2;break;case"right":n.x=-t,n.y=-a/2;break}return!k((r=this.props)===null||r===void 0?void 0:r.translateX)&&(n.x=0),!k((e=this.props)===null||e===void 0?void 0:e.translateY)&&(n.y=0),n},i}(),Ht=function(){function i(t,a){var r,e,n,o;this.options=t,this.partialWidth=this.options.width,this.partialHeight=this.options.height,this.rows=((r=this.options.gridLayoutOptions)===null||r===void 0?void 0:r.rows)||1,this.cols=((e=this.options.gridLayoutOptions)===null||e===void 0?void 0:e.cols)||1,this.matrix=((n=this.options.gridLayoutOptions)===null||n===void 0?void 0:n.matrix)||Pt(this.rows,this.cols,1),this.gap=((o=this.options.gridLayoutOptions)===null||o===void 0?void 0:o.gap)||[0,0],this.partialCanvas=a}return i.prototype.draw=function(){var t,a,r,e,n,o,d,l,s=K.createCanvas(((t=this.options.gridLayoutOptions)===null||t===void 0?void 0:t.width)||this.partialWidth*this.cols+this.gap[0]*this.cols,((a=this.options.gridLayoutOptions)===null||a===void 0?void 0:a.height)||this.partialHeight*this.rows+this.gap[1]*this.rows),u=s.getContext("2d");!((r=this.options.gridLayoutOptions)===null||r===void 0)&&r.backgroundImage&&(u==null||u.drawImage((e=this.options.gridLayoutOptions)===null||e===void 0?void 0:e.backgroundImage,0,0,(n=this.options.gridLayoutOptions)===null||n===void 0?void 0:n.width,(o=this.options.gridLayoutOptions)===null||o===void 0?void 0:o.height));for(var c=0;c<this.rows;c++)for(var m=0;m<this.cols;m++)!((l=(d=this.matrix)===null||d===void 0?void 0:d[c])===null||l===void 0)&&l[m]&&(u==null||u.drawImage(this.partialCanvas,this.partialWidth*m+this.gap[0]*m,this.partialHeight*c+this.gap[1]*c,this.partialWidth,this.partialHeight));return s},i}(),Wt=function(i,t){switch(i.layout){case"grid":return new Ht(i,t).draw();default:return t}},At=function(i){var t,a,r;switch(i.layout){case"grid":{var e=((t=i.gridLayoutOptions)===null||t===void 0?void 0:t.cols)||1,n=((a=i.gridLayoutOptions)===null||a===void 0?void 0:a.rows)||1,o=((r=i.gridLayoutOptions)===null||r===void 0?void 0:r.gap)||[0,0];return[i.width*e+o[0]*e,i.height*n+o[1]*n]}default:return[i.width,i.height]}};const Et={props:{width:{type:Number,default:h.width},height:{type:Number,default:h.height},rotate:{type:Number,default:h.rotate},layout:{type:String,default:h.layout},gridLayoutOptions:{type:Object,default:void 0},auxiliaryLine:{type:Boolean,default:h.auxiliaryLine},globalAlpha:{type:Number,default:h.globalAlpha},zIndex:{type:Number,default:10},movable:{type:Boolean,default:h.movable},mode:{type:String,default:h.mode},backgroundPosition:{type:String,default:h.backgroundPosition},backgroundRepeat:{type:String,default:h.backgroundRepeat},translatePlacement:{type:String,default:void 0},translateX:{type:Number,default:void 0},translateY:{type:Number,default:void 0},contentType:{type:String,default:h.contentType},content:{type:String,default:h.content},textType:{type:String,default:h.textType},lineHeight:{type:Number,default:h.lineHeight},fontSize:{type:String,default:h.fontSize},fontFamily:{type:String,default:h.fontFamily},fontStyle:{type:String,default:h.fontStyle},fontVariant:{type:String,default:h.fontVariant},fontColor:{type:String,default:h.fontColor},fontWeight:{type:String,default:h.fontWeight},textAlign:{type:String,default:void 0},textBaseline:{type:String,default:void 0},filter:{type:String,default:h.filter},textRowMaxWidth:{type:Number,default:void 0},richTextWidth:{type:Number,default:void 0},richTextHeight:{type:Number,default:void 0},image:{type:String,default:void 0},imageWidth:{type:Number,default:h.imageWidth},imageHeight:{type:Number,default:h.imageHeight},shadowStyle:{type:Object,default:void 0},advancedStyle:{type:Object,default:void 0},appendToBody:{type:Boolean,default:!1}},emits:["success","error","beforeDestroy","destroyed","observeSuccess","observeError"],data(){return{key:null,watermarkCanvas:null,watermarkImage:null,observer:null,parentObserve:null,observing:!1}},computed:{options(){return{...h,...this.$props}},watermarkWrapperStyle(){const i=this.mutationObserve?"!important":"";return{...this.mutationObserve&&{"z-index":`${this.zIndex}${i}`,display:`block${i}`,visibility:`visible${i}`,transform:`none${i}`,scale:`none${i}`},position:`relative${i}`}},watermarkStyle(){const i=this.mutationObserve?"!important":"",t=At({layout:this.layout,width:this.width,height:this.height,gridLayoutOptions:this.gridLayoutOptions});return{...this.mutationObserve&&{visibility:`visible${i}`,transform:`none${i}`,scale:`none${i}`},"z-index":`${this.zIndex}${i}`,display:`block${i}`,width:`100%${i}`,height:`100%${i}`,"pointer-events":`none${i}`,left:`0${i}`,right:`0${i}`,top:`0${i}`,bottom:`0${i}`,position:`${this.appendToBody?"fixed":"absolute"}${i}`,"background-image":`url(${this.watermarkImage})${i}`,"background-repeat":`${this.backgroundRepeat}${i}`,"background-size":`${t[0]}px ${t[1]}px${i}`,"background-position":`${this.backgroundPosition}${i}`,...this.movable&&{animation:`200s ease 0s infinite normal none running watermark ${i}`}}}},watch:{options:{deep:!0,handler:async function(){await this.create()}}},created(){},async mounted(){await this.create(),this.$emit("success")},methods:{generateKey(){return this.mutationObserve?rt(6):"watermark"},create:D(async function(){this.watermarkCanvas=new K(this.$props,this.options),this.remove(),this.key=this.generateKey();try{await this.$nextTick(()=>{this.draw()})}catch{this.$emit("error")}},10),update:D(async function(){this.remove(),this.key=this.generateKey();try{await this.$nextTick(()=>{this.draw()})}catch{this.$emit("error")}},10),async draw(){var i,t,a;this.mutationObserve&&(this.$refs.watermarkWrapperRef.id=`watermark-${this.key}`),await((i=this.watermarkCanvas)==null?void 0:i.draw());const r=Wt(this.options,(t=this.watermarkCanvas)==null?void 0:t.getCanvas());this.watermarkImage=$t(r),(a=this.watermarkCanvas)==null||a.clear(),await this.$nextTick(()=>{this.handleObserver()})},remove(){var i;this.$emit("beforeDestroy"),this.removeObserver(),this.mutationObserve&&((i=document.querySelector(`#watermark-${this.key}`))==null||i.remove()),this.$emit("destroyed")},handleObserver(){if(!this.mutationObserve){this.observing=!1;return}try{!this.observing&&this.addObserver(),this.observing=!0,this.$emit("observeSuccess")}catch{this.$emit("observeError"),this.observing=!1}},addObserver(){const i=this.$refs.watermarkWrapperRef,t=i.parentElement;this.observer=new MutationObserver(async a=>{a.length>0&&await this.update()}),this.observer.observe(i,{attributes:!0,childList:!0,subtree:!1,characterData:!0}),this.parentObserve=new MutationObserver(async a=>{var r;for(const e of a)((e==null?void 0:e.target)===i||((r=e==null?void 0:e.removedNodes)==null?void 0:r[0])===i||e.type==="childList"&&e.target===t&&e.target.lastChild!==i)&&await this.update()}),this.parentObserve.observe(t,{attributes:!0,childList:!0,subtree:!0,characterData:!0})},removeObserver(){var i,t;(i=this.observer)==null||i.disconnect(),(t=this.parentObserve)==null||t.disconnect(),this.observing=!1}}},Mt=J({name:"Watermark",directives:{},mixins:[Et],props:{modelValue:{type:Boolean,default:!0}},emits:["update:modelValue"],data(){return{}},computed:{},watch:{modelValue(i){i?this.handleObserver():this.removeObserver()}},created(){},mounted(){},methods:{}});function jt(i,t,a,r,e,n){return i.key?(E(),Z(et,{to:"body",disabled:!i.appendToBody,key:i.key},[tt("div",{style:N(i.watermarkWrapperStyle),ref:"watermarkWrapperRef"},[q(i.$slots,"default"),i.modelValue?(E(),Y("div",{key:0,style:N(i.watermarkStyle)},null,4)):B("",!0)],4)],8,["disabled"])):B("",!0)}const X=U(Mt,[["render",jt]]),Nt={install(i){i.component(X.name,X),i.component(R.name,R)}};export{Nt as default,R as teleport,X as watermark};
